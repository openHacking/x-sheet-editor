!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}n.r(t);var s=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],u={String:1,Boolean:2,Number:3,Object:4,Array:5,Function:6,Null:7,Undefined:8,Promise:9,GeneratorFunction:10,AsyncFunction:11,BigInt:12,Symbol:13,DedicatedWorkerGlobalScope:14,Date:15,RegExp:16,Un:0},c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,n=null,i=[{key:"isWindows",value:function(){return/windows|win32/i.test(navigator.userAgent)}},{key:"isMac",value:function(){return/macintosh|mac os x/i.test(navigator.userAgent)}},{key:"isNotEmptyObject",value:function(t){return!e.isEmptyObject(t)}},{key:"isEmptyObject",value:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},{key:"isUnDef",value:function(e){return null==e}},{key:"isDef",value:function(e){return!this.isUnDef(e)}},{key:"isNumber",value:function(e){return/^(-?\d+.\d+)$|^(-?\d+)$/.test(e)}},{key:"isFraction",value:function(e){return/^\d+\/\d+$/.test(e)}},{key:"isDate",value:function(t){return e.type(t)===u.Date}},{key:"isFunction",value:function(t){return e.type(t)===u.Function}},{key:"isArray",value:function(t){return e.type(t)===u.Array}},{key:"isObject",value:function(t){return e.type(t)===u.Object}},{key:"isRegExp",value:function(t){return e.type(t)===u.EX}},{key:"isLikeArray",value:function(t){return!e.isUnDef(t)&&"number"==typeof t.length}},{key:"isBlank",value:function(t){return!!e.isUnDef(t)||""===t.toString().trim()}},{key:"isPlainObject",value:function(t){return!e.isUnDef(t)&&Object.getPrototypeOf(t)===Object.getPrototypeOf({})}},{key:"isString",value:function(t){return e.type(t)===u.String}},{key:"isChildType",value:function(e,t){return e instanceof t}},{key:"toLowCase",value:function(e){return e.toLowerCase()}},{key:"type",value:function(e){var t=Object.prototype.toString.call(e);switch(t){case"[object Null]":return u.Null;case"[object Object]":return u.Object;case"[object Undefined]":return u.Undefined;case"[object String]":return u.String;case"[object Boolean]":return u.Boolean;case"[object Number]":return u.Number;case"[object Function]":return u.Function;case"[object Array]":return u.Array;case"[object Promise]":return u.Promise;case"[object GeneratorFunction]":return u.GeneratorFunction;case"[object AsyncFunction]":return u.AsyncFunction;case"[object BigInt]":return u.BigInt;case"[object Symbol]":return u.Symbol;case"[object Date]":return u.Date;case"[object DedicatedWorkerGlobalScope]":return u.DedicatedWorkerGlobalScope;default:return u.Un}}},{key:"copy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.isUnDef(t))return{};for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return e.isUnDef(r)||0===r.length||r.forEach((function(n){e.isUnDef(n)||Object.keys(n).forEach((function(r){var i=n[r];"string"==typeof i||"number"==typeof i||"boolean"==typeof i?t[r]=i:"function"!=typeof i&&!Array.isArray(i)&&e.isPlainObject(i)?(t[r]=t[r]||{},e.copy(t[r],i)):t[r]=i}))})),t}},{key:"cloneDeep",value:function(e){var t=JSON.stringify(e);return JSON.parse(t)}},{key:"extends",value:function(t){for(var n=0,r=arguments.length<=1?0:arguments.length-1;n<r;n++){var i=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];e.isDef(a)&&(t[o]=a)}}return t}},{key:"sum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},n=0,r=0;return Object.keys(e).forEach((function(i){n+=t(e[i],i),r+=1})),[n,r]}},{key:"parseFloat",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){return e.isNumber(t)?parseFloat(t):0}))},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){return e.isNumber(t)?parseInt(t,10):0}))},{key:"stringAt",value:function(e){for(var t="",n=e;n>=s.length;)n/=s.length,n-=1,t+=s[parseInt(n,10)%s.length];return t+=s[e%s.length]}},{key:"indexAt",value:function(e){for(var t=0,n=0;n<e.length-1;n+=1){var r=e.charCodeAt(n)-65,i=e.length-1-n;t+=Math.pow(s.length,i)+s.length*r}return t+=e.charCodeAt(e.length-1)-65}},{key:"expr2xy",value:function(t){for(var n="",r="",i=0;i<t.length;i+=1)t.charAt(i)>="0"&&t.charAt(i)<="9"?r+=t.charAt(i):n+=t.charAt(i);return[e.indexAt(n),parseInt(r,10)-1]}},{key:"xy2expr",value:function(t,n){return"".concat(e.stringAt(t)).concat(n+1)}},{key:"expr2expr",value:function(t,n,i){var o=r(e.expr2xy(t),2),a=o[0],s=o[1];return e.xy2expr(a+n,s+i)}},{key:"minIf",value:function(e,t){return e<t?t:e}},{key:"keepLastIndex",value:function(e){var t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()}},{key:"trim",value:function(e){return this.isBlank(e)?"":e.trim()}},{key:"now",value:function(){return Date.now().toString()}},{key:"viewPort",value:function(){return{width:window.innerWidth,height:window.innerHeight}}},{key:"exitFullscreen",value:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},{key:"fullScreen",value:function(e){e.el&&(e=e.el),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}},{key:"isFull",value:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}},{key:"uuid",value:function(){return"".concat(a()+a()).concat(a()).concat(a()).concat(a()).concat(a()).concat(a()).concat(a())}},{key:"equals",value:function(t,n){function r(t,n){return e.type(t)===e.type(n)&&(e.isArray(t)?function(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++){var o=e[n],a=t[n];if(!r(o,a))return!1}return!0}(t,n):e.isObject(t)?function(e,t){var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var o=0,a=n;o<a.length;o++){var s=a[o];if(!i.includes(s))return!1;var u=e[s],c=t[s];if(!r(u,c))return!1}return!0}(t,n):e.isDate(t)?t.getTime()===n.getTime():e.isRegExp(t)?t.toString()===n.toString():t===n)}return r(t,n)}},{key:"toFixed",value:function(e,t){return e.toString().indexOf(".")>-1?e.toFixed(t):e}},{key:"getExplorerInfo",value:function(){var e=window.navigator.userAgent.toLowerCase();return e.indexOf("firefox")>=0?{type:"Firefox",version:e.match(/firefox\/([\d.]+)/)[1]}:e.indexOf("chrome")>=0?{type:"Chrome",version:e.match(/chrome\/([\d.]+)/)[1]}:e.indexOf("opera")>=0?{type:"Opera",version:e.match(/opera.([\d.]+)/)[1]}:e.indexOf("safari")>=0?{type:"Safari",version:e.match(/version\/([\d.]+)/)[1]}:e.indexOf("msie")>=0?{type:"IE",version:e.match(/msie ([\d.]+)/)[1]}:void 0}},{key:"arrayLast",value:function(e){return e[e.length-1]}},{key:"arrayHead",value:function(e){return e[0]}},{key:"blankClear",value:function(t){return e.isString(t)?t.replace(/\s*/g,e.EMPTY):t}},{key:"safeValue",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.isUnDef(t)?n:t}},{key:"inWorker",value:function(){return e.type(self)===u.DedicatedWorkerGlobalScope}},{key:"if",value:function(e,t,n){return e?t():n()}},{key:"slice",value:function(e){return Array.prototype.slice.call(e)}},{key:"clearBlank",value:function(e){return e?e.replace(/\s/g,""):e}},{key:"clearHideCode",value:function(e){for(var t="",n=0;n<e.length;n++){var r=e.charAt(n);"%EF%BB%BF"!==encodeURI(r)&&(t+=r)}return t}}],n&&o(t.prototype,n),i&&o(t,i),e}();function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}c.EMPTY="",c.Nul=null,c.Undef=void 0,c.noop=function(){},c.DATA_TYPE=u;var h=function(){function e(t){var n=t.draw,r=t.ruler,i=t.attr;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.draw=n,this.attr=i,this.ruler=r}var t,n,r;return t=e,(n=[{key:"setRuler",value:function(e){this.ruler=e}},{key:"getAlignPadding",value:function(){return this.attr.align===e.ALIGN.center?0:this.attr.padding}},{key:"getVerticalAlignPadding",value:function(){return this.attr.verticalAlign===e.VERTICAL_ALIGN.center?0:this.attr.padding}}])&&l(t.prototype,n),r&&l(t,r),e}();function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),e}h.VERTICAL_ALIGN={top:"top",center:"middle",bottom:"bottom"},h.ALIGN={left:"left",center:"center",right:"right"},h.TEXT_WRAP={OVER_FLOW:1,WORD_WRAP:2,TRUNCATE:3},h.TEXT_DIRECTION={HORIZONTAL:"horizontal",VERTICAL:"vertical",ANGLE:"angle",ANGLE_BAR:"bar"},h.DEFAULT_FONT_ATTR={name:"Arial",size:14,color:"rgb(0,0,0)",bold:!1,italic:!1,strikethrough:!1,underline:!1,angle:0,padding:8,align:h.ALIGN.left,textWrap:h.TEXT_WRAP.TRUNCATE,verticalAlign:h.VERTICAL_ALIGN.center,direction:h.TEXT_DIRECTION.HORIZONTAL},h.DEFAULT_RICH_ATTR={angle:0,padding:8,align:h.ALIGN.left,textWrap:h.TEXT_WRAP.TRUNCATE,verticalAlign:h.VERTICAL_ALIGN.center,direction:h.TEXT_DIRECTION.HORIZONTAL},h.DEFAULT_RICH_ITEM_ATTR={name:"Arial",size:14,color:"rgb(0,0,0)",bold:!1,italic:!1,strikethrough:!1,underline:!1};var d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";f(this,e),"string"==typeof t?(this.el=document.createElement(t),n&&(this.el.className=n)):this.el=t,this.map={}}return y(e,null,[{key:"wrapElement",value:function(t){if([c.isArray(t),t instanceof HTMLCollection,t instanceof NodeList].includes(!0)){for(var n=[],r=0;r<t.length;r++){var i=t[r];i instanceof e?n.push(i):n.push(new e(i))}return n}return new e(t)}},{key:"createText",value:function(t){return new e(document.createTextNode(t))}},{key:"hyphenateRE",value:function(e){return e?e.replace(/([A-Z])/g,"-$1").toLowerCase():null}}]),y(e,[{key:"data",value:function(e,t){return void 0!==t?(this.map[e]=t,this):this.map[e]}},{key:"children",value:function(){for(var t=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return 0===arguments.length?e.wrapElement(this.el.children):(r.forEach((function(e){return t.append(e)})),this)}},{key:"childrenNodes",value:function(){for(var t=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return 0===arguments.length?e.wrapElement(this.el.childNodes):(r.forEach((function(e){return t.append(e)})),this)}},{key:"childrenNodesAppend",value:function(e){var t=this;return this.isTextNode()||e.childrenNodes().forEach((function(e){return t.append(e)})),this}},{key:"childrenNodesPrepend",value:function(e){var t=this;return this.isTextNode()||e.childrenNodes().forEach((function(e){return t.prepend(e)})),this}},{key:"append",value:function(e){return this.isTextNode()||e&&e.el&&this.el.append(e.el),this}},{key:"prepend",value:function(e){return this.isTextNode()||e&&e.el&&this.el.prepend(e.el),this}},{key:"offset",value:function(e){var t=this;if(void 0!==e)return Object.keys(e).forEach((function(n){t.css(n,"".concat(e[n],"px"))})),this;var n=this.el,r=n.offsetTop,i=n.offsetLeft,o=this.el;return{top:r,left:i,height:o.offsetHeight,width:o.offsetWidth}}},{key:"parent",value:function(){return this.el.parentNode?new e(this.el.parentNode):null}},{key:"addClass",value:function(e){return this.isTextNode()||this.el.classList.add(e),this}},{key:"hasClass",value:function(e){return!this.isTextNode()&&this.el.classList.contains(e)}},{key:"hasChildElement",value:function(){return this.children().length>0}},{key:"hasChild",value:function(){return this.childrenNodes().length>0}},{key:"removeClass",value:function(e){return this.isTextNode()||this.el.classList.remove(e),this}},{key:"box",value:function(){return this.isTextNode()?null:this.el.getBoundingClientRect()}},{key:"first",value:function(){return this.isTextNode()?null:e.wrapElement(this.el.firstChild)}},{key:"last",value:function(){return this.isTextNode()?null:e.wrapElement(this.el.lastChild)}},{key:"firstTextNode",value:function(){if(this.isTextNode())return this;var e=null;return function t(n){n.hasChild()&&n.childrenNodes().forEach((function(n){null===e&&t(n)})),null===e&&n.isTextNode()&&(e=n)}(this),e}},{key:"lastTextNode",value:function(){if(this.isTextNode())return this;var e=null;return function t(n){n.hasChild()&&n.childrenNodes().reverse().forEach((function(n){null===e&&t(n)})),null===e&&n.isTextNode()&&(e=n)}(this),e}},{key:"remove",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e)this.isTextNode()||this.el.removeChild(e.el||e);else{var t=this.parent();t&&this.parent().remove(this)}return this}},{key:"contains",value:function(e){return!this.isTextNode()&&this.el.contains(e.el)}},{key:"prev",value:function(){return this.el.previousSibling?e.wrapElement(this.el.previousSibling):null}},{key:"next",value:function(){return this.el.nextSibling?e.wrapElement(this.el.nextSibling):null}},{key:"active",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"active";return this.isTextNode()||(e?this.addClass(t):this.removeClass(t)),this}},{key:"text",value:function(e){return this.isTextNode()?this.nodeValue():void 0!==e?(this.el.innerText=e,this):this.el.innerText}},{key:"html",value:function(e){return this.isTextNode()?this.nodeValue():void 0!==e?(this.el.innerHTML=e,this):this.el.innerHTML}},{key:"focus",value:function(){return this.isTextNode()||this.el.focus(),this}},{key:"blur",value:function(){return this.isTextNode()||this.el.blur(),this}},{key:"removeAttr",value:function(e){return this.isTextNode()||this.el.removeAttribute(e),this}},{key:"style",value:function(e){return this.isTextNode()||this.attr("style",e),this}},{key:"attr",value:function(e,t){var n=this;if(!this.isTextNode())if(void 0!==t)this.el.setAttribute&&this.el.setAttribute(e,t);else{if("string"==typeof e)return this.el.setAttribute?this.el.getAttribute(e):null;this.el.setAttribute&&Object.keys(e).forEach((function(t){n.el.setAttribute(t,e[t])}))}return this}},{key:"val",value:function(e){return this.isTextNode()?void 0===e?this.nodeValue():this:void 0!==e?(this.el.value=e,this):this.el.value}},{key:"get",value:function(){return this.el}},{key:"cssRemoveKeys",value:function(){var t=this;if(!this.isTextNode()&&this.el.style){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach((function(n){t.el.style&&t.el.style.removeProperty(e.hyphenateRE(n))}))}return this}},{key:"cssRemoveVal",value:function(t,n){if(!this.isTextNode()&&this.el.style){var r=e.hyphenateRE(t),i=this.el.style.getPropertyValue(r).replace(n,"");this.css(t,i)}return this}},{key:"css",value:function(t,n){var r=this;if(!this.isTextNode()&&this.el.style){if(void 0===n&&"string"!=typeof t)return Object.keys(t).forEach((function(n){var i=e.hyphenateRE(n);r.el.style.setProperty(i,t[n])})),this;if(void 0!==n){var i=e.hyphenateRE(t);return this.el.style.setProperty(i,n),this}var o=e.hyphenateRE(t);return this.el.style.getPropertyValue(o)}return null}},{key:"computedStyle",value:function(){return this.isTextNode()?null:window.getComputedStyle(this.el,null)}},{key:"show",value:function(){if(!this.isTextNode()){var e=this.computedStyle();e&&"block"!==e.display&&this.css("display","block")}return this}},{key:"hide",value:function(){if(!this.isTextNode()){var e=this.computedStyle();e&&"none"!==e.display&&this.css("display","none")}return this}},{key:"trigger",value:function(e,t){if(!this.isTextNode())switch(e){case"click":var n=new MouseEvent(e,{detail:t,bubbles:!0,cancelable:!1});n.initEvent("click",!0,!0),this.el.dispatchEvent(n);break;default:var r=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!1});this.el.dispatchEvent(r)}}},{key:"find",value:function(t){if(!this.isTextNode()){var n=this.el.querySelectorAll(t);if(n&&1===n.length)return new e(n[0]);var r=[];if(n){var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;r.push(new e(c))}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}return r}return[]}},{key:"finds",value:function(t){if(!this.isTextNode()){var n=this.el.querySelectorAll(t),r=[];if(n){var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;r.push(new e(c))}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}return r}return[]}},{key:"sibling",value:function(){for(var t=this.el,n=[];null!==(t=t.previousElementSibling);)n.push(new e(t));for(t=this.el;null!==(t=t.nextElementSibling);)n.push(new e(t));return n}},{key:"tagName",value:function(){return this.el.nodeName.toLocaleLowerCase()}},{key:"nodeValue",value:function(){return this.el.nodeValue}},{key:"nodeType",value:function(){return this.el.nodeType}},{key:"after",value:function(e){return this.el&&e&&e.el&&this.el.after(e.el),this}},{key:"before",value:function(e){return this.el&&e&&e.el&&this.el.before(e.el),this}},{key:"clone",value:function(){return new e(this.el.cloneNode(!0))}},{key:"empty",value:function(){return this.isTextNode()||this.html(""),this}},{key:"equals",value:function(e){return this.el===e.el}},{key:"index",value:function(){var e=this,t=this.parent(),n=-1;return t.childrenNodes().forEach((function(t,r){t.equals(e)&&(n=r)})),n}},{key:"is",value:function(e){return this.el===e.el}},{key:"isTextNode",value:function(){return"#text"===this.tagName()}},{key:"isBreakNode",value:function(){return"br"===this.tagName()}},{key:"isDocumentFragment",value:function(){return this.el instanceof DocumentFragment}}]),e}(),p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new d(e,t)},g=("".concat("x-sheet"," 1.0.0-develop"),{});function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}g.WORK_BODY_EVENT_TYPE={CHANGE_ACTIVE:"changeactive",REMOVE_SHEET:"removesheet"},g.SYSTEM_EVENT_TYPE={MOUSE_MOVE:"mousemove",MOUSE_DOWN:"mousedown",CONTEXT_MENU:"contextmenu",SCROLL:"scroll",RESIZE:"resize",MOUSE_UP:"mouseup",INPUT:"input",KEY_DOWN:"keydown",KEY_UP:"keyup",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",MOUSE_ENTER:"mouseenter",CLICK:"click",FOCUS:"focus",DRAG_START:"dragstart",CHANGE:"change",VISIBILITY_CHANGE:"visibilitychange"},g.TABLE_EVENT_TYPE={RENDER:"render",SNAPSHOT_CHANGE:"snapshotchange",CHANGE_ROW_HEIGHT:"changerowheight",CHANGE_COL_WIDTH:"changecolwidth",SCALE_CHANGE:"scalechange",EDIT_START:"editstart",EDIT_INPUT:"editinput",EDIT_FINISH:"editfinish",REMOVE_ROW:"removerow",REMOVE_COL:"removecol",ADD_NEW_ROW:"addnewrow",ADD_NEW_COL:"addnewcol",FIXED_CHANGE:"fixedchange",FIXED_COL_CHANGE:"fixedcolchange",FIXED_ROW_CHANGE:"fixedrowchange",SELECT_OVER:"selectover",SELECT_DOWN:"selectdown",SELECT_CHANGE:"selectchange",DATA_CHANGE:"datachange",RESIZE_CHANGE:"resizechange"},g.FORM_EVENT_TYPE={SEARCH_INPUT_CHANGE:"searchinputchange",PLAIN_INPUT_CHANGE:"plaininputchange",FORM_SELECT_CHANGE:"formselectchange"};var x=new(function(){function e(){m(this,e),this.pool=[]}return k(e,[{key:"unbind",value:function(e,t,n,r){e instanceof d&&(e=e.el);var i=this.remove(e,t,n,r);i.length?i.forEach((function(t){e.removeEventListener(t.type,t.callback,t.option)})):e.removeEventListener(t,n,r)}},{key:"bind",value:function(e,t,n,r){e instanceof d&&(e=e.el),this.pool.push({ele:e,type:t,callback:n,option:r}),e.addEventListener(t,n,r)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=[],o=[];return this.pool.forEach((function(a){var s=e===a.ele,u=null===r||r===a.option,c="*"===t||t===a.type,l=null===n||n===a.callback;s&&c&&l&&u?o.push(a):i.push(a)})),this.pool=i,o}},{key:"multipleUnbind",value:function(e,t,n,r){var i=this;e.forEach((function(e){i.unbind(e,t,n,r)}))}},{key:"multipleBind",value:function(e,t,n,r){var i=this;e.forEach((function(e){i.bind(e,t,n,r)}))}}]),e}()),w=function(){function e(){m(this,e)}return k(e,null,[{key:"unbind",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Array.isArray(e)?x.multipleUnbind(e,t,n,r):x.unbind(e,t,n,r),e}},{key:"bind",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Array.isArray(e)?x.multipleBind(e,t,n,r):x.bind(e,t,n,r),e}},{key:"mouseHold",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:150,o=setInterval((function(){n()}),i),a=function n(i){clearInterval(o),e.unbind(t,g.SYSTEM_EVENT_TYPE.MOUSE_UP,n,!0),r(i)};n(),e.bind(t,g.SYSTEM_EVENT_TYPE.MOUSE_UP,a,!0)}},{key:"mouseMoveUp",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=function(e){n(e),e.stopPropagation(),e.preventDefault()},o=function n(o){e.unbind(t,g.SYSTEM_EVENT_TYPE.MOUSE_MOVE,i,!0),e.unbind(t,g.SYSTEM_EVENT_TYPE.MOUSE_UP,n,!0),r(o),o.preventDefault()};return e.bind(t,g.SYSTEM_EVENT_TYPE.MOUSE_MOVE,i,!0),e.bind(t,g.SYSTEM_EVENT_TYPE.MOUSE_UP,o,!0),t}}]),e}();function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t,n){return(E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),e}function N(e,t){if(t&&("object"===T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}w.WrapFuncion={doubleClick:function(e){var t=0,n=0,r=0;return function(i){if(2===i.button)return t=0,r=0,void(n=0);var o=i.pageX,a=i.pageY,s=Date.now();s-r<=300&&o===t&&a===n?(e(i),r=0,t=0,n=0):(t=o,n=a,r=s)}},mouseClick:function(e){return function(t){e(t)}}};var P=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return O(this,t),(e=N(this,"string"==typeof n?_(t).call(this,r,"".concat("x-sheet","-widget ").concat(n)):_(t).call(this,n))).$$rootFlag=i,N(e)}return I(t,e),A(t,[{key:"childrenNodes",value:function(){for(var e,n=this,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return i.forEach((function(e){e.parentWidget&&e.parentWidget(n)})),(e=E(_(t.prototype),"childrenNodes",this)).call.apply(e,[this].concat(i))}},{key:"attach",value:function(e){this.childrenNodes(e),e.parentWidget(this),e.onAttach(this)}},{key:"before",value:function(e){return e.parentWidget(this),E(_(t.prototype),"before",this).call(this,e)}},{key:"after",value:function(e){return e.parentWidget(this),E(_(t.prototype),"after",this).call(this,e)}},{key:"unbind",value:function(){w.unbind(this)}},{key:"bind",value:function(){}},{key:"eventXy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,n=t.box(),r=n.top,i=n.left;return{y:e.clientY-r,x:e.clientX-i}}},{key:"destroy",value:function(){this.unbind(),this.remove()}},{key:"closestClass",value:function(e){for(var t=this;!p(document.body).is(t);){if(t.hasClass(e))return t;t=t.parent()}return null}},{key:"getRootBox",value:function(){return this.getRootWidget().box()}},{key:"relativeBox",value:function(){var e=this.getRootWidget(),t=this.box(),n=e.box();return{right:n.right-t.right,bottom:n.bottom-t.bottom,top:t.top-n.top,left:t.left-n.left,width:t.width,height:t.height}}},{key:"getRootWidget",value:function(){for(var e=this.data("parent");e&&!e.$$rootFlag;)e=e.data("parent");return e}},{key:"parentWidget",value:function(e){return e?(this.data("parent",e),this):this.data("parent")}}]),t}(function(e){function t(){return O(this,t),N(this,_(t).apply(this,arguments))}return I(t,e),A(t,[{key:"onAttach",value:function(){}}]),t}(d));function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var D=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return M(this,t),(e=X(this,j(t).call(this,"".concat("x-sheet","-icon")))).iconNameEl=p("div","".concat("x-sheet","-icon-img ").concat(n)),e.childrenNodes(e.iconNameEl),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,e),n=t,(r=[{key:"setWidth",value:function(e){this.iconNameEl.css("width","".concat(e,"px"))}},{key:"setHeight",value:function(e){this.iconNameEl.css("height","".concat(e,"px"))}}])&&Y(n.prototype,r),i&&Y(n,i),t}(P);function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e,t,n){return(U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=V(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var G=[],z=function(e){function t(e){var n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}(this,V(t).call(this,"".concat("x-sheet","-drag-panel"))),G.push(F(r)),r.options=c.copy({position:t.DRAG_PANEL_POSITION.CENTER},e),r.status=!1,r.mask=p("div","".concat("x-sheet","-drag-panel-mask")),r.content=p("div","".concat("x-sheet","-drag-panel-content")),U((n=F(r),V(t.prototype)),"childrenNodes",n).call(n,r.content),r.bind(),r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,e),n=t,i=[{key:"removeInstance",value:function(e){var t=[];G.forEach((function(n){n!==e&&t.push(n)})),G=t}},{key:"closeAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];G.forEach((function(t){-1===e.indexOf(t)&&t.close()}))}}],(r=[{key:"open",value:function(){var e=this.getRootWidget(),t=this.mask;return!1===this.status&&e&&(this.status=!0,e.childrenNodes(t),e.childrenNodes(this),this.dragPanelLocation()),this}},{key:"close",value:function(){var e=this.getRootWidget();if(!0===this.status&&e){var t=this.mask;this.status=!1,e.remove(this),e.remove(t)}return this}},{key:"unbind",value:function(){var e=this.mask;w.unbind(e)}},{key:"bind",value:function(){var e=this,t=this.mask;w.bind(t,g.SYSTEM_EVENT_TYPE.MOUSE_DOWN,(function(t){e.close(),t.stopPropagation()})),w.bind(this,g.SYSTEM_EVENT_TYPE.MOUSE_DOWN,(function(t){if(0===t.button){var n=e.getRootWidget().box(),r=e.eventXy(t);w.mouseMoveUp(p(document),(function(t){var i=t.pageY-n.top-r.y,o=t.pageX-n.left-r.x;e.offset({top:i,left:o}),t.stopPropagation()})),t.stopPropagation()}}))}},{key:"dragPanelLocation",value:function(){var e=this.getRootWidget(),n=this.options.position,r=e.box(),i=this.box();switch(n){case t.DRAG_PANEL_POSITION.LEFT:case t.DRAG_PANEL_POSITION.RIGHT:case t.DRAG_PANEL_POSITION.TOP:break;case t.DRAG_PANEL_POSITION.CENTER:this.offset({left:r.width/2-i.width/2,top:r.height/2-i.height/2})}return this}},{key:"childrenNodes",value:function(){var e;return(e=this.content).childrenNodes.apply(e,arguments),this}},{key:"destroy",value:function(){U(V(t.prototype),"destroy",this).call(this),this.unbind(),t.removeInstance(this)}}])&&B(n.prototype,r),i&&B(n,i),t}(P);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e,t,n){return(K="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=J(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}z.DRAG_PANEL_POSITION={LEFT:1,TOP:2,RIGHT:3,CENTER:4};var ee=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){if(t&&("object"===q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return $(e)}(this,J(t).call(this,"".concat("x-sheet","-color-picker")))).options=c.copy({selectCb:function(){}},e),n.dragPanel=(new z).parentWidget($(n)),n.color=[360,0,100],n.preViewColorPoint=p("div","".concat("x-sheet","-color-picker-pre-view-color-point")),n.colorValueTips=p("div","".concat("x-sheet","-color-picker-color-value-tips")),n.colorValueTips.text("十六进制颜色值"),n.colorInput=p("input","".concat("x-sheet","-color-picker-color-input")),n.top=p("div","".concat("x-sheet","-color-picker-top")),n.top.childrenNodes(n.preViewColorPoint),n.top.childrenNodes(n.colorValueTips),n.top.childrenNodes(n.colorInput),n.selectColorPoint=p("div","".concat("x-sheet","-color-picker-select-color-point")),n.selectColorArea1=p("div","".concat("x-sheet","-color-picker-select-color-area area1")),n.selectColorArea2=p("div","".concat("x-sheet","-color-picker-select-color-area area2")),n.selectColorArea3=p("div","".concat("x-sheet","-color-picker-select-color-area area3")),n.center=p("div","".concat("x-sheet","-color-picker-center")),n.center.childrenNodes(n.selectColorArea1),n.center.childrenNodes(n.selectColorArea2),n.center.childrenNodes(n.selectColorArea3),n.center.childrenNodes(n.selectColorPoint),n.colorHuxTips=p("div","".concat("x-sheet","-color-picker-color-hux-tips")),n.colorBar=p("div","".concat("x-sheet","-color-picker-color-bar")),n.colorBarPoint=p("div","".concat("x-sheet","-color-picker-bar-point")),n.bottom=p("div","".concat("x-sheet","-color-picker-bottom")),n.colorHuxTips.text("HUE"),n.colorBar.childrenNodes(n.colorBarPoint),n.bottom.childrenNodes(n.colorHuxTips),n.bottom.childrenNodes(n.colorBar),n.cancelButton=p("div","".concat("x-sheet","-color-picker-button cancel")),n.selectButton=p("div","".concat("x-sheet","-color-picker-button select")),n.buttons=p("div","".concat("x-sheet","-color-picker-buttons")),n.cancelButton.text("取消"),n.selectButton.text("确定"),n.buttons.childrenNodes(n.selectButton),n.buttons.childrenNodes(n.cancelButton),n.childrenNodes(n.top),n.childrenNodes(n.center),n.childrenNodes(n.bottom),n.childrenNodes(n.buttons),n.dragPanel.childrenNodes($(n)),n.dragPanel.css("background","#ffffff"),n.bind(),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,e),n=t,i=[{key:"fixHex",value:function(e){var t=6-e.length;if(t>0){for(var n=[],r=0;r<t;r+=1)n.push("0");n.push(e),e=n.join("")}return e}},{key:"fixHsx",value:function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),x:Math.min(100,Math.max(0,e.x))}}},{key:"isRgb",value:function(e){return e.startsWith("rgb")}},{key:"isHex",value:function(e){return e.startsWith("#")}},{key:"isDark",value:function(e){if(c.isString(e)){if(this.isHex(e)){var n=t.hexToRgb(e);e="rgb(".concat(n.r,", ").concat(n.g,", ").concat(n.b,")")}var r=t.parseRgb(e);return.299*r.r+.578*r.g+.114*r.b>=192}return!1}},{key:"hexToRgb",value:function(e){return{r:(e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16))>>16,g:(65280&e)>>8,b:255&e}}},{key:"hexToHsb",value:function(e){return this.rgbToHsb(this.hexToRgb(e))}},{key:"rgbToHsb",value:function(e){var t={h:0,s:0,x:0},n=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-n;return t.x=r,t.s=0!==r?255*i/r:0,0!==t.s?e.r===r?t.h=(e.g-e.b)/i:e.g===r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.x*=100/255,t}},{key:"hsbToRgb",value:function(e){var t={},n=e.h,r=255*e.s/100,i=255*e.x/100;if(0===r)t.r=i,t.g=i,t.b=i;else{var o=i,a=(255-r)*i/255,s=n%60*(o-a)/60;360===n&&(n=0),n<60?(t.r=o,t.b=a,t.g=a+s):n<120?(t.g=o,t.b=a,t.r=o-s):n<180?(t.g=o,t.r=a,t.b=a+s):n<240?(t.b=o,t.r=a,t.g=o-s):n<300?(t.b=o,t.g=a,t.r=a+s):n<360?(t.r=o,t.g=a,t.b=o-s):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}}},{key:"rgbToHex",value:function(e){var t=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return t.forEach((function(e,n){1===e.length&&(t[n]="0".concat(e))})),t.join("")}},{key:"hsbToHex",value:function(e){return this.rgbToHex(this.hsbToRgb(e))}},{key:"parseRgb",value:function(e){var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}}},{key:"parseRgbToHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){if(this.isHex(e))return e.substring(1);var n=this.parseRgb(e);return this.rgbToHex(n)}return t}},{key:"parseHexToRgb",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var r=t.hexToRgb(e);return"rgb(".concat(r.r,",").concat(r.g,",").concat(r.b,")")}return n}}],(r=[{key:"unbind",value:function(){var e=this.selectColorPoint,t=this.colorBarPoint,n=this.colorInput,r=this.cancelButton,i=this.selectButton;w.unbind(n),w.unbind(n),w.unbind(t),w.unbind(e),w.unbind(r),w.unbind(i)}},{key:"bind",value:function(){var e=this,n=this.selectColorPoint,r=this.center,i=this.colorBarPoint,o=this.colorBar,a=this.colorInput,s=this.cancelButton,u=this.selectButton;w.bind(a,g.SYSTEM_EVENT_TYPE.MOUSE_DOWN,(function(e){e.stopPropagation()})),w.bind(a,g.SYSTEM_EVENT_TYPE.CHANGE,(function(){var t=a.val();t&&e.hexColor(t)})),w.bind(i,g.SYSTEM_EVENT_TYPE.MOUSE_DOWN,(function(t){var n=e.eventXy(t,o),r=o.box();n.x<0&&(n.x=0),n.x>r.width&&(n.x=r.width),e.downHue(n.x,r.width),w.mouseMoveUp(p(document),(function(t){var n=e.eventXy(t,o),r=o.box();n.x<0&&(n.x=0),n.x>r.width&&(n.x=r.width),e.moveHue(n.x,r.width)})),t.stopPropagation()})),w.bind(n,g.SYSTEM_EVENT_TYPE.MOUSE_DOWN,(function(t){var n=e.eventXy(t,r),i=r.box();n.x<0&&(n.x=0),n.x>i.width&&(n.x=i.width),n.y<0&&(n.y=0),n.y>i.height&&(n.y=i.height),e.downSelect(n.x,n.y,i.width,i.height),w.mouseMoveUp(p(document),(function(t){var n=e.eventXy(t,r);n.x<0&&(n.x=0),n.x>i.width&&(n.x=i.width),n.y<0&&(n.y=0),n.y>i.height&&(n.y=i.height),e.moveSelect(n.x,n.y,i.width,i.height)})),t.stopPropagation()})),w.bind(s,g.SYSTEM_EVENT_TYPE.CLICK,(function(){e.close()})),w.bind(u,g.SYSTEM_EVENT_TYPE.CLICK,(function(){var n=e.color,r=t.fixHsx({h:parseInt(n[0],10),s:parseInt(n[1],10),x:parseInt(n[2],10)}),i=t.hsbToRgb(r);e.options.selectCb("rgb(".concat(i.r,",").concat(i.g,",").concat(i.b,")")),e.close()}))}},{key:"open",value:function(e){if(this.dragPanel.open(),e){if(t.isRgb(e)){var n=t.parseRgb(e);e=t.rgbToHex(n)}this.hexColor(e)}else this.change();return this}},{key:"close",value:function(){return this.dragPanel.close(),this}},{key:"sliderPosition",value:function(e){var t=this.colorBar,n=this.colorBarPoint,r=n.box(),i=t.box(),o=parseInt(i.width-i.width*e.h/360,10);o-=r.width/2,n.offset({left:o});var a=this.center,s=this.selectColorPoint,u=s.box(),c=a.box(),l=parseInt(c.width*e.s/100,10),h=parseInt(c.height*(100-e.x)/100,10);l-=u.width/2,h-=u.height/2,s.offset({left:l,top:h})}},{key:"hueChange",value:function(){var e=this.color,n=t.fixHsx({h:parseInt(e[0],10),s:parseInt(e[1],10),x:parseInt(e[2],10)}),r=this.colorBarPoint,i=this.selectColorPoint,o=this.preViewColorPoint,a=this.selectColorArea1,s=this.colorInput,u=t.hsbToHex(n),c=t.hsbToHex({h:n.h,s:100,x:100});i.css("backgroundColor","#".concat(u)),o.css("backgroundColor","#".concat(u)),r.css("backgroundColor","#".concat(c)),a.css("backgroundColor","#".concat(c)),s.val("#".concat(u)),this.sliderPosition(n)}},{key:"selectChange",value:function(){var e=this.color,n=t.fixHsx({h:parseInt(e[0],10),s:parseInt(e[1],10),x:parseInt(e[2],10)}),r=this.preViewColorPoint,i=this.selectColorPoint,o=this.colorInput,a=t.hsbToHex(n);i.css("backgroundColor","#".concat(a)),r.css("backgroundColor","#".concat(a)),o.val("#".concat(a)),this.sliderPosition(n)}},{key:"change",value:function(){this.hueChange(),this.selectChange()}},{key:"downSelect",value:function(e,t,n,r){var i=this.color;i[1]=parseInt(100*e/n,10),i[2]=parseInt(100*(r-t)/r,10),this.selectChange()}},{key:"moveSelect",value:function(e,t,n,r){var i=this.color;i[1]=parseInt(100*Math.max(0,Math.min(n,e))/n,10),i[2]=parseInt(100*(r-Math.max(0,Math.min(r,t)))/r,10),this.selectChange()}},{key:"downHue",value:function(e,t){this.color[0]=parseInt(360*(t-e)/t,10),this.hueChange()}},{key:"moveHue",value:function(e,t){this.color[0]=parseInt(360*(t-Math.max(0,Math.min(t,e)))/t,10),this.hueChange()}},{key:"hexColor",value:function(e){var n=this.color,r=t.hexToHsb(t.fixHex(e));n[0]=r.h,n[1]=r.s,n[2]=r.x,this.change()}},{key:"destroy",value:function(){K(J(t.prototype),"destroy",this).call(this),this.unbind(),this.dragPanel.destroy()}}])&&Z(n.prototype,r),i&&Z(n,i),t}(P);function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t){if(t&&("object"===te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ae=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=re(this,ie(t).call(this,"".concat("x-sheet","-color-array-item")))).options=c.copy({color:null,icon:null},e),n.icon=n.options.icon,n.color=c.blankClear(n.options.color),n.icon&&n.childrenNodes(n.options.icon),n.color&&(n.css("backgroundColor",n.color),ee.isDark(n.options.color)?(n.checkedIcon=new D("checked-dark"),n.childrenNodes(n.checkedIcon)):(n.checkedIcon=new D("checked-light"),n.childrenNodes(n.checkedIcon)),n.checkedIcon.hide()),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(t,e),n=t,(r=[{key:"setActive",value:function(e){this.checkedIcon&&(e?this.checkedIcon.show():this.checkedIcon.hide())}}])&&ne(n.prototype,r),i&&ne(n,i),t}(P);function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ce(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function le(e,t,n){return(le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=he(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ve=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ce(this,he(t).call(this,"".concat("x-sheet","-color-array")))).options=c.copy({colors:[new ae({color:"rgb(0, 0, 0)"}),new ae({color:"rgb(67, 67, 67)"}),new ae({color:"rgb(102, 102, 102)"}),new ae({color:"rgb(153, 153, 153)"}),new ae({color:"rgb(183, 183, 183)"}),new ae({color:"rgb(204, 204, 204)"}),new ae({color:"rgb(217, 217, 217)"}),new ae({color:"rgb(239, 239, 239)"}),new ae({color:"rgb(255, 255, 255)"}),new ae({color:"rgb(152, 0, 0)"}),new ae({color:"rgb(255, 0, 0)"}),new ae({color:"rgb(255, 153, 0)"}),new ae({color:"rgb(255, 255, 0)"}),new ae({color:"rgb(0, 255, 0)"}),new ae({color:"rgb(0, 255, 255)"}),new ae({color:"rgb(74, 134, 232)"}),new ae({color:"rgb(0, 0, 255)"}),new ae({color:"rgb(153, 0, 255)"}),new ae({color:"rgb(255, 0, 255)"}),new ae({color:"rgb(230, 184, 175)"}),new ae({color:"rgb(244, 204, 204)"}),new ae({color:"rgb(252, 229, 205)"}),new ae({color:"rgb(255, 242, 204)"}),new ae({color:"rgb(217, 234, 211)"}),new ae({color:"rgb(208, 224, 227)"}),new ae({color:"rgb(201, 218, 248)"}),new ae({color:"rgb(207, 226, 243)"}),new ae({color:"rgb(217, 210, 233)"}),new ae({color:"rgb(234, 209, 220)"}),new ae({color:"rgb(221, 126, 107)"}),new ae({color:"rgb(234, 153, 153)"}),new ae({color:"rgb(249, 203, 156)"}),new ae({color:"rgb(255, 229, 153)"}),new ae({color:"rgb(182, 215, 168)"}),new ae({color:"rgb(162, 196, 201)"}),new ae({color:"rgb(164, 194, 244)"}),new ae({color:"rgb(159, 197, 232)"}),new ae({color:"rgb(180, 167, 214)"}),new ae({color:"rgb(213, 166, 189)"}),new ae({color:"rgb(204, 65, 37)"}),new ae({color:"rgb(224, 102, 102)"}),new ae({color:"rgb(246, 178, 107)"}),new ae({color:"rgb(255, 217, 102)"}),new ae({color:"rgb(147, 196, 125)"}),new ae({color:"rgb(118, 165, 175)"}),new ae({color:"rgb(109, 158, 235)"}),new ae({color:"rgb(111, 168, 220)"}),new ae({color:"rgb(142, 124, 195)"}),new ae({color:"rgb(194, 123, 160)"}),new ae({color:"rgb(166, 28, 0)"}),new ae({color:"rgb(204, 0, 0)"}),new ae({color:"rgb(230, 145, 56)"}),new ae({color:"rgb(241, 194, 50)"}),new ae({color:"rgb(106, 168, 79)"}),new ae({color:"rgb(69, 129, 142)"}),new ae({color:"rgb(60, 120, 216)"}),new ae({color:"rgb(61, 133, 198)"}),new ae({color:"rgb(103, 78, 167)"}),new ae({color:"rgb(166, 77, 121)"}),new ae({color:"rgb(133, 32, 12)"}),new ae({color:"rgb(153, 0, 0)"}),new ae({color:"rgb(180, 95, 6)"}),new ae({color:"rgb(191, 144, 0)"}),new ae({color:"rgb(56, 118, 29)"}),new ae({color:"rgb(19, 79, 92)"}),new ae({color:"rgb(17, 85, 204)"}),new ae({color:"rgb(11, 83, 148)"}),new ae({color:"rgb(53, 28, 117)"}),new ae({color:"rgb(116, 27, 71)"}),new ae({color:"rgb(91, 15, 0)"}),new ae({color:"rgb(102, 0, 0)"}),new ae({color:"rgb(120, 63, 4)"}),new ae({color:"rgb(127, 96, 0)"}),new ae({color:"rgb(39, 78, 19)"}),new ae({color:"rgb(12, 52, 61)"}),new ae({color:"rgb(28, 69, 135)"}),new ae({color:"rgb(7, 55, 99)"}),new ae({color:"rgb(32, 18, 77)"}),new ae({color:"rgb(76, 17, 48)"})],selectCb:function(){}},e),n.colors=[],n.activeColor=null,n.options.colors.forEach((function(e){n.add(e)})),n.colors.length>0&&n.setActiveByColor(n.colors[0].options.color),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,e),n=t,(r=[{key:"add",value:function(e){-1===this.colors.findIndex((function(t){return t.color===e.color}))&&(this.colors.push(e),this.childrenNodes(e),this.bind(e))}},{key:"unbind",value:function(){this.colors.forEach((function(e){w.unbind(e)}))}},{key:"bind",value:function(e){var t=this;w.bind(e,g.SYSTEM_EVENT_TYPE.MOUSE_DOWN,(function(){t.options.selectCb(e),e.options.color&&t.setActiveByColor(e.options.color)}))}},{key:"findItemByColor",value:function(e){return e=c.blankClear(e),this.colors.find((function(t){return t.color===e}))}},{key:"setActiveByColor",value:function(e){var t=this;e=c.blankClear(e),this.colors.forEach((function(n){n.color===e?(n.setActive(!0),t.activeColor=n.color):n.setActive(!1)}))}},{key:"clear",value:function(){this.unbind(),this.colors=[],this.empty()}},{key:"destroy",value:function(){le(he(t.prototype),"destroy",this).call(this),this.unbind()}}])&&ue(n.prototype,r),i&&ue(n,i),t}(P);function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}ve.BLACK="rgb(0, 0, 0)",ve.NULL=null,ve.WHITE="rgb(255, 255, 255)";var pe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.align,r=void 0===n?h.ALIGN.left:n,i=t.verticalAlign,o=void 0===i?h.VERTICAL_ALIGN.center:i,a=t.textWrap,s=void 0===a?h.TEXT_WRAP.TRUNCATE:a,u=t.strikethrough,c=void 0!==u&&u,l=t.underline,f=void 0!==l&&l,v=t.color,y=void 0===v?ve.BLACK:v,d=t.name,p=void 0===d?"Arial":d,g=t.size,m=void 0===g?14:g,b=t.bold,k=void 0!==b&&b,x=t.italic,w=void 0!==x&&x,T=t.angle,E=void 0===T?0:T,O=t.direction,C=void 0===O?h.TEXT_DIRECTION.HORIZONTAL:O,A=t.padding,N=void 0===A?5:A;ye(this,e),this.align=r,this.verticalAlign=o,this.textWrap=s,this.strikethrough=c,this.underline=f,this.color=y,this.name=p,this.size=m,this.bold=k,this.italic=w,this.direction=C,this.angle=E,this.padding=N}var t,n,r;return t=e,(n=[{key:"like",value:function(e){for(var t=Object.keys(this),n=Object.keys(e),r=0,i=n;r<i.length;r++){var o=i[r];if(!t.includes(o))return!1}for(var a=0,s=n;a<s.length;a++){var u=s[a],l=this[u],h=e[u];switch(u){case"color":l=c.clearBlank(l),h=c.clearBlank(h)}if(l!==h)return!1}return!0}},{key:"clone",value:function(){return new e({align:this.align,verticalAlign:this.verticalAlign,textWrap:this.textWrap,strikethrough:this.strikethrough,underline:this.underline,color:this.color,name:this.name,size:this.size,bold:this.bold,italic:this.italic,angle:this.angle,direction:this.direction,padding:this.padding})}},{key:"reset",value:function(){this.align=h.ALIGN.left,this.verticalAlign=h.VERTICAL_ALIGN.center,this.textWrap=h.TEXT_WRAP.TRUNCATE,this.strikethrough=!1,this.underline=!1,this.color=ve.BLACK,this.name="Arial",this.size=14,this.bold=!1,this.italic=!1,this.angle=0,this.direction=h.TEXT_DIRECTION.HORIZONTAL,this.padding=5}},{key:"equals",value:function(e){for(var t=Object.keys(this),n=Object.keys(e),r=0,i=t;r<i.length;r++){var o=i[r];if(!n.includes(o))return!1}for(var a=0,s=t;a<s.length;a++){var u=s[a],l=this[u],h=e[u];switch(u){case"color":l=c.clearBlank(l),h=c.clearBlank(h)}if(l!==h)return!1}return!0}}])&&de(t.prototype,n),r&&de(t,r),e}();function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e){return function(e){if(Array.isArray(e))return xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ke(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||ke(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(e,t){if(e){if("string"==typeof e)return xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(e,t):void 0}}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function we(e,t,n){return(we="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ee(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Te(e,t){if(t&&("object"===ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e,t,n){return t&&Ne(e.prototype,t),n&&Ne(e,n),e}pe.EMPTY=new pe,pe.getInstance=function(e){return e?new pe(e):pe.EMPTY};var Ie=c.inWorker()?1:devicePixelRatio,Se=Math.round(Ie),Pe=Se+2,Re=Pe+2,Me=Se/2,Ye=function(){function e(t){Ae(this,e),this.canvas=t,this.ctx=t.getContext("2d")}return _e(e,null,[{key:"srcPx",value:function(e){return e/this.dpr()}},{key:"cssPx",value:function(e){return this.srcPx(this.stylePx(e))}},{key:"stylePx",value:function(e){return this.round(e*this.dpr())}},{key:"round",value:function(e){return Math.round(e)}},{key:"ceil",value:function(e){return Math.ceil(e)}},{key:"trunc",value:function(e){return Math.trunc(e)}},{key:"radian",value:function(e){return-e*(Math.PI/180)}},{key:"dpr",value:function(){return Ie}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Ie=c.inWorker()?e:devicePixelRatio,Se=Math.round(Ie),Re=(Pe=Se+2)+2,Me=Se/2}}]),_e(e,[{key:"attr",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];("string"==typeof n||n instanceof String)&&(n=n.trim()),this.ctx[t]!==n&&(this.ctx[t]=n)}return this}},{key:"resize",value:function(t,n){var r=this.canvas;return r.width=e.stylePx(t),r.height=e.stylePx(n),r.style.width="".concat(r.width/e.dpr(),"px"),r.style.height="".concat(r.height/e.dpr(),"px"),this}}]),e}(),Xe=function(e){function t(e){var n;return Ae(this,t),(n=Te(this,Ee(t).call(this,e))).lineWidthType=t.LINE_WIDTH_TYPE.low,n.lineColor="rgb(0,0,0)",n}return Oe(t,e),_e(t,null,[{key:"offsetToLineInside",value:function(e){return Se>1?e-Me:e-Se}},{key:"getLineWidthTypePx",value:function(e){switch(e){case t.LINE_WIDTH_TYPE.medium:return Pe;case t.LINE_WIDTH_TYPE.low:return Se;case t.LINE_WIDTH_TYPE.high:return Re}return 0}}]),_e(t,[{key:"corsLine",value:function(e,n){var r=this,i=be(e,2),o=i[0],a=i[1],s=be(n,2),u=s[0],c=s[1],l=this.lineWidthType,h=this.lineColor,f=Se;switch(l){case t.LINE_WIDTH_TYPE.medium:f=Pe;break;case t.LINE_WIDTH_TYPE.low:f=Se;break;case t.LINE_WIDTH_TYPE.high:f=Re}this.attr({strokeStyle:h,lineWidth:f}),this.polyStroke((function(e){var t=be(e,2),n=t[0],i=t[1];return[Ye.round(n+r.getOffsetX())-Me,Ye.round(i+r.getOffsetY())-Me]}),[o,a],[u,c])}},{key:"setLineColor",value:function(e){this.lineColor=e}},{key:"setLineWidthType",value:function(e){this.lineWidthType=e}},{key:"horizonLine",value:function(e,t){var n=be(e,2),r=n[0],i=n[1],o=be(t,2),a=o[0],s=o[1];if(i!==s)throw new TypeError("Error Horizon Line");this.corsLine([r,i],[a,s])}},{key:"verticalLine",value:function(e,t){var n=be(e,2),r=n[0],i=n[1],o=be(t,2),a=o[0],s=o[1];if(r!==a)throw new TypeError("Error Vertical Line");this.corsLine([r,i],[a,s])}}]),t}(function(e){function t(){return Ae(this,t),Te(this,Ee(t).apply(this,arguments))}return Oe(t,e),_e(t,[{key:"line",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.polyStroke.apply(this,[function(t){var n=be(t,2),r=n[0],i=n[1];return[e.linePx(Ye.round(r+e.getOffsetX())),e.linePx(Ye.round(i+e.getOffsetY()))]}].concat(n)),this}},{key:"linePx",value:function(e){return this.ctx.lineWidth%2==0?e:e-.5}}]),t}(function(e){function t(e){var n;return Ae(this,t),(n=Te(this,Ee(t).call(this,e))).offsetX=0,n.offsetY=0,n}return Oe(t,e),_e(t,[{key:"offset",value:function(e,t){this.offsetX=e,this.offsetY=t}},{key:"getOffsetX",value:function(){return this.offsetX}},{key:"getOffsetY",value:function(){return this.offsetY}},{key:"fillText",value:function(){throw TypeError("child impl")}},{key:"fillRect",value:function(){throw TypeError("child impl")}},{key:"rect",value:function(){throw TypeError("child impl")}},{key:"drawImage",value:function(){throw TypeError("child impl")}}]),t}(function(e){function t(){return Ae(this,t),Te(this,Ee(t).apply(this,arguments))}return Oe(t,e),_e(t,[{key:"polyStroke",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=this.ctx;if((arguments.length<=1?0:arguments.length-1)>1){this.beginPath();var n=e(arguments.length<=1?void 0:arguments[1]),r=be(n,2),i=r[0],o=r[1];t.moveTo(i,o);for(var a=1,s=arguments.length<=1?0:arguments.length-1;a<s;a+=1){var u=e(a+1<1||arguments.length<=a+1?void 0:arguments[a+1]),c=be(u,2),l=c[0],h=c[1];t.lineTo(l,h)}t.stroke()}}},{key:"polyInFill",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=this.ctx;if((arguments.length<=1?0:arguments.length-1)>1){this.beginPath();var n=e(arguments.length<=1?void 0:arguments[1]),r=be(n,2),i=r[0],o=r[1];t.moveTo(i,o);for(var a=1,s=arguments.length<=1?0:arguments.length-1;a<s;a+=1){var u=e(a+1<1||arguments.length<=a+1?void 0:arguments[a+1]),c=be(u,2),l=c[0],h=c[1];t.lineTo(l,h)}t.fill()}}},{key:"fullRect",value:function(){var e=this.canvas,t=e.width,n=e.height;return this.ctx.fillRect(0,0,t,n),this}},{key:"rotate",value:function(e){return we(Ee(t.prototype),"rotate",this).call(this,Ye.radian(e)),this}}]),t}(function(e){function t(e){var n;return Ae(this,t),(n=Te(this,Ee(t).call(this,e))).dash=[],n}return Oe(t,e),_e(t,[{key:"beginPath",value:function(){return this.ctx.beginPath(),this}},{key:"measureText",value:function(e){return this.ctx.measureText(e)}},{key:"save",value:function(){return this.ctx.save(),this}},{key:"restore",value:function(){return this.ctx.restore(),this}},{key:"fill",value:function(){return this.ctx.fill(),this}},{key:"clip",value:function(){return this.ctx.clip(),this}},{key:"setLineDash",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.ctx;return this.dash=e,t.setLineDash(e),this}},{key:"scale",value:function(e,t){return this.ctx.scale(e,t),this}},{key:"translate",value:function(e,t){return this.ctx.translate(e,t),this}},{key:"rotate",value:function(e){return this.ctx.rotate(e),this}}]),t}(Ye)))));Xe.LINE_WIDTH_TYPE={low:"low",medium:"medium",high:"high"};var je=function(e){function t(){return Ae(this,t),Te(this,Ee(t).apply(this,arguments))}return Oe(t,e),_e(t,[{key:"fillText",value:function(e,n,r){return n+=this.getOffsetX(),r+=this.getOffsetY(),this.ctx.fillText(e,t.round(n),t.round(r)),this}},{key:"fillPath",value:function(e){var t=this;return this.polyInFill.apply(this,[function(e){var n=e.x,r=e.y;return[Ye.round(n+t.getOffsetX()),Ye.round(r+t.getOffsetY())]}].concat(me(e.points))),this}},{key:"fillRect",value:function(e,n,r,i){return e+=this.getOffsetX(),n+=this.getOffsetY(),this.ctx.fillRect(t.round(e),t.round(n),t.round(r),t.round(i)),this}},{key:"rect",value:function(e,n,r,i){return e+=this.getOffsetX(),n+=this.getOffsetY(),this.ctx.rect(t.round(e),t.round(n),t.round(r),t.round(i)),this}},{key:"copyImage",value:function(e,n,r,i,o,a,s,u){var c=this.ctx;return o+=this.getOffsetX(),e+=this.getOffsetX(),a+=this.getOffsetY(),n+=this.getOffsetY(),c.drawImage(this.canvas,t.round(e),t.round(n),t.round(r),t.round(i),t.round(o),t.round(a),t.round(s),t.round(u)),this}},{key:"drawImage",value:function(e,n,r,i,o,a,s,u,c){var l=this.ctx;return a+=this.getOffsetX(),s+=this.getOffsetY(),l.drawImage(e,t.round(n),t.round(r),t.round(i),t.round(o),t.round(a),t.round(s),t.round(u),t.round(c)),this}}]),t}(Xe);function Le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(e,t,n){return t&&De(e.prototype,t),n&&De(e,n),e}var Be=0,Fe=3,He=function(){function e(t,n){Le(this,e),this.draw=t,c.copy(this,{color:"rgb(0,0,0)",widthType:je.LINE_WIDTH_TYPE.low,padding:1,spacing:e.spacing,leftShow:function(){return!1},topShow:function(){return!1},rightShow:function(){return!1},bottomShow:function(){return!1},iFMerge:function(){return!1},iFMergeFirstRow:function(){return!1},iFMergeLastRow:function(){return!1},iFMergeFirstCol:function(){return!1},iFMergeLastCol:function(){return!1}},n)}return We(e,[{key:"setWidthType",value:function(e){this.widthType=e}},{key:"setColor",value:function(e){this.color=e}},{key:"handleExternal",value:function(e,t,n,r,i,o,a){var s={},u=this.leftShow,c=this.topShow,l=this.rightShow,h=this.bottomShow,f=this.iFMerge,v=this.iFMergeFirstRow,y=this.iFMergeLastRow,d=this.iFMergeFirstCol,p=this.iFMergeLastCol,g=this.spacing,m=null,b=null,k=null,x=null,w=null;switch(a){case"left":(m=f(i,o-1))&&(b=v(i,o-1),k=y(i,o-1),x=d(i,o-1),w=p(i,o-1));break;case"top":(m=f(i-1,o))&&(b=v(i-1,o),k=y(i-1,o),x=d(i-1,o),w=p(i-1,o));break;case"right":(m=f(i,o+1))&&(b=v(i,o+1),k=y(i,o+1),x=d(i,o+1),w=p(i,o+1));break;case"bottom":(m=f(i+1,o))&&(b=v(i+1,o),k=y(i+1,o),x=d(i+1,o),w=p(i+1,o))}if(m){switch(a){case"left":s.sx=e-g,s.ex=n-g;var T=h(i-1,o-1)||c(i,o-1),E=c(i,o),O=h(i-1,o);s.sy=t,(E||O)&&(s.sy=t-g),T&&b&&(s.sy=t+g);var C=c(i+1,o-1)||h(i,o-1),A=h(i,o),N=c(i+1,o);s.ey=r,(A||N)&&(s.ey=r+g),C&&k&&(s.ey=r-g);break;case"top":s.sy=t-g,s.ey=r-g;var _=l(i-1,o-1)||u(i-1,o),I=u(i,o),S=l(i,o-1);s.sx=e,(I||S)&&(s.sx=e-g),_&&x&&(s.sx=e+g);var P=u(i-1,o+1)||l(i-1,o),R=l(i,o),M=u(i,o+1);s.ex=n,(R||M)&&(s.ex=n+g),P&&w&&(s.ex=n-g);break;case"right":s.sx=e+g,s.ex=n+g;var Y=h(i-1,o+1)||c(i,o+1),X=c(i,o),j=h(i-1,o);s.sy=t,(X||j)&&(s.sy=t-g),Y&&b&&(s.sy=t+g);var L=c(i+1,o+1)||h(i,o+1),D=h(i,o),W=c(i+1,o);s.ey=r,(D||W)&&(s.ey=r+g),L&&k&&(s.ey=r-g);break;case"bottom":s.sy=t+g,s.ey=r+g;var B=l(i+1,o-1)||u(i+1,o),F=u(i,o),H=l(i,o-1);s.sx=e,(F||H)&&(s.sx=e-g),B&&x&&(s.sx=e+g);var U=u(i+1,o+1)||l(i+1,o),V=l(i,o),G=u(i,o+1);s.ex=n,(V||G)&&(s.ex=n+g),U&&w&&(s.ex=n-g)}return s}switch(a){case"left":s.sx=e-g,s.ex=n-g;var z=h(i-1,o-1)||c(i,o-1),q=c(i,o),Z=h(i-1,o);s.sy=t,(q||Z)&&(s.sy=t-g),z&&(s.sy=t+g);var $=c(i+1,o-1)||h(i,o-1),K=h(i,o),J=c(i+1,o);s.ey=r,(K||J)&&(s.ey=r+g),$&&(s.ey=r-g);break;case"top":s.sy=t-g,s.ey=r-g;var Q=l(i-1,o-1)||u(i-1,o),ee=u(i,o),te=l(i,o-1);s.sx=e,(ee||te)&&(s.sx=e-g),Q&&(s.sx=e+g);var ne=u(i-1,o+1)||l(i-1,o),re=l(i,o),ie=u(i,o+1);s.ex=n,(re||ie)&&(s.ex=n+g),ne&&(s.ex=n-g);break;case"right":s.sx=e+g,s.ex=n+g;var oe=h(i-1,o+1)||c(i,o+1),ae=c(i,o),se=h(i-1,o);s.sy=t,(ae||se)&&(s.sy=t-g),oe&&(s.sy=t+g);var ue=c(i+1,o+1)||h(i,o+1),ce=h(i,o),le=c(i+1,o);s.ey=r,(ce||le)&&(s.ey=r+g),ue&&(s.ey=r-g);break;case"bottom":s.sy=t+g,s.ey=r+g;var he=l(i+1,o-1)||u(i+1,o),fe=u(i,o),ve=l(i,o-1);s.sx=e,(fe||ve)&&(s.sx=e-g),he&&(s.sx=e+g);var ye=u(i+1,o+1)||l(i+1,o),de=l(i,o),pe=u(i,o+1);s.ex=n,(de||pe)&&(s.ex=n+g),ye&&(s.ex=n-g)}return s}},{key:"handleInternal",value:function(e,t,n,r,i,o,a){var s={},u=this.leftShow,c=this.topShow,l=this.rightShow,h=this.bottomShow,f=this.iFMerge,v=this.iFMergeFirstRow,y=this.iFMergeLastRow,d=this.iFMergeFirstCol,p=this.iFMergeLastCol,g=this.spacing;if(f(i,o)){var m=v(i,o),b=y(i,o),k=d(i,o),x=p(i,o);switch(a){case"left":s.sx=e+g,s.ex=n+g;var w=h(i-1,o-1)||c(i,o-1),T=c(i,o),E=h(i-1,o);s.sy=t,w&&(s.sy=t-g),(T||E)&&m&&(s.sy=t+g);var O=c(i+1,o-1)||h(i,o-1),C=h(i,o),A=c(i+1,o);s.ey=r,O&&(s.ey=r+g),(C||A)&&b&&(s.ey=r-g);break;case"top":s.sy=t+g,s.ey=r+g;var N=l(i-1,o-1)||u(i-1,o),_=u(i,o),I=l(i,o-1);s.sx=e,N&&(s.sx=e-g),(_||I)&&k&&(s.sx=e+g);var S=u(i-1,o+1)||l(i-1,o),P=l(i,o),R=u(i,o+1);s.ex=n,S&&(s.ex=n+g),(P||R)&&x&&(s.ex=n-g);break;case"right":s.sx=e-g,s.ex=n-g;var M=h(i-1,o+1)||c(i,o+1),Y=c(i,o),X=h(i-1,o);s.sy=t,M&&(s.sy=t-g),(Y||X)&&m&&(s.sy=t+g);var j=c(i+1,o+1)||h(i,o+1),L=h(i,o),D=c(i+1,o);s.ey=r,j&&(s.ey=r+g),(L||D)&&b&&(s.ey=r-g);break;case"bottom":s.sy=t-g,s.ey=r-g;var W=l(i+1,o-1)||u(i+1,o),B=u(i,o),F=l(i,o-1);s.sx=e,W&&(s.sx=e-g),(B||F)&&k&&(s.sx=e+g);var H=u(i+1,o+1)||l(i+1,o),U=l(i,o),V=u(i,o+1);s.ex=n,H&&(s.ex=n+g),(U||V)&&x&&(s.ex=n-g)}return s}switch(a){case"left":s.sx=e+g,s.ex=n+g;var G=h(i-1,o-1)||c(i,o-1),z=c(i,o),q=h(i-1,o);s.sy=t,G&&(s.sy=t-g),(z||q)&&(s.sy=t+g);var Z=c(i+1,o-1)||h(i,o-1),$=h(i,o),K=c(i+1,o);s.ey=r,Z&&(s.ey=r+g),($||K)&&(s.ey=r-g);break;case"top":s.sy=t+g,s.ey=r+g;var J=l(i-1,o-1)||u(i-1,o),Q=u(i,o),ee=l(i,o-1);s.sx=e,J&&(s.sx=e-g),(Q||ee)&&(s.sx=e+g);var te=u(i-1,o+1)||l(i-1,o),ne=l(i,o),re=u(i,o+1);s.ex=n,te&&(s.ex=n+g),(ne||re)&&(s.ex=n-g);break;case"right":s.sx=e-g,s.ex=n-g;var ie=h(i-1,o+1)||c(i,o+1),oe=c(i,o),ae=h(i-1,o);s.sy=t,ie&&(s.sy=t-g),(oe||ae)&&(s.sy=t+g);var se=c(i+1,o+1)||h(i,o+1),ue=h(i,o),ce=c(i+1,o);s.ey=r,se&&(s.ey=r+g),(ue||ce)&&(s.ey=r-g);break;case"bottom":s.sy=t-g,s.ey=r-g;var le=l(i+1,o-1)||u(i+1,o),he=u(i,o),fe=l(i,o-1);s.sx=e,le&&(s.sx=e-g),(he||fe)&&(s.sx=e+g);var ve=u(i+1,o+1)||l(i+1,o),ye=l(i,o),de=u(i,o+1);s.ex=n,ve&&(s.ex=n+g),(ye||de)&&(s.ex=n-g)}return s}},{key:"horizonLine",value:function(e,t,n,r,i,o,a){var s=this.draw,u=this.widthType,l=this.color;s.setLineColor(l),s.setLineWidthType(u),s.setLineDash([]);var h=this.handleExternal(e,t,n,r,i,o,a),f=this.handleInternal(e,t,n,r,i,o,a);c.isEmptyObject(f)||s.horizonLine([f.sx,f.sy],[f.ex,f.ey]),c.isEmptyObject(h)||s.horizonLine([h.sx,h.sy],[h.ex,h.ey])}},{key:"verticalLine",value:function(e,t,n,r,i,o,a){var s=this.draw,u=this.widthType,l=this.color;s.setLineColor(l),s.setLineWidthType(u),s.setLineDash([]);var h=this.handleExternal(e,t,n,r,i,o,a),f=this.handleInternal(e,t,n,r,i,o,a);c.isEmptyObject(f)||s.verticalLine([f.sx,f.sy],[f.ex,f.ey]),c.isEmptyObject(h)||s.verticalLine([h.sx,h.sy],[h.ex,h.ey])}},{key:"tiltingLine",value:function(e,t,n,r,i,o,a){}}]),e}();He.spacing=je.dpr()>=2?3:2;function Ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ge(e,t,n){return t&&Ve(e.prototype,t),n&&Ve(e,n),e}var ze=0,qe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.widthType,r=void 0===n?je.LINE_WIDTH_TYPE.low:n,i=t.type,o=void 0===i?Be:i,a=t.width,s=void 0===a?-1:a,u=t.color,c=void 0===u?"rgb(0,0,0)":u,l=t.zIndex,h=void 0===l?0:l,f=t.display,v=void 0!==f&&f;Ue(this,e),this.zIndex=h,this.display=v,this.color=c,this.type=o,this.widthType=1===s?je.LINE_WIDTH_TYPE.low:2===s?je.LINE_WIDTH_TYPE.medium:3===s?je.LINE_WIDTH_TYPE.high:r,h>ze&&(ze=h)}return Ge(e,null,[{key:"getZIndex",value:function(){return ze+=1}}]),Ge(e,[{key:"priority",value:function(e){if(c.isUnDef(e))return-2;var t=this.zIndex,n=e.zIndex;return t>n?1:n>t?-1:0}},{key:"setColor",value:function(t){this.zIndex=e.getZIndex(),this.color=t}},{key:"setDisplay",value:function(t){this.zIndex=e.getZIndex(),this.display=t}},{key:"setType",value:function(t){this.zIndex=e.getZIndex(),this.type=t}},{key:"setZIndex",value:function(e){this.zIndex=e}},{key:"setWidthType",value:function(t){this.zIndex=e.getZIndex(),this.widthType=t}},{key:"clone",value:function(){return new e({widthType:this.widthType,color:this.color,zIndex:this.zIndex,type:this.type,display:this.display})}},{key:"equal",value:function(e){var t=this.widthType===e.widthType,n=this.color===e.color,r=this.type===e.type;return n&&t&&r}}]),e}();function Ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ke=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.left,r=void 0===n?{}:n,i=t.bottom,o=void 0===i?{}:i,a=t.top,s=void 0===a?{}:a,u=t.right,c=void 0===u?{}:u;Ze(this,e),this.left=new qe(r),this.bottom=new qe(o),this.top=new qe(s),this.right=new qe(c)}var t,n,r;return t=e,(n=[{key:"hasDouble",value:function(){var e=this.top,t=this.left,n=this.right,r=this.bottom;return e.type===Fe||t.type===Fe||n.type===Fe||r.type===Fe}},{key:"isDisplay",value:function(){return this.left.display||this.top.display||this.bottom.display||this.right.display}},{key:"setAllDisplay",value:function(e){this.setBDisplay(e),this.setLDisplay(e),this.setTDisplay(e),this.setRDisplay(e)}},{key:"setLDisplay",value:function(e){this.left.setDisplay(e)}},{key:"setTDisplay",value:function(e){this.top.setDisplay(e)}},{key:"setRDisplay",value:function(e){this.right.setDisplay(e)}},{key:"setBDisplay",value:function(e){this.bottom.setDisplay(e)}},{key:"setAllColor",value:function(e){this.setBColor(e),this.setLColor(e),this.setTColor(e),this.setRColor(e)}},{key:"setLColor",value:function(e){this.left.setColor(e)}},{key:"setTColor",value:function(e){this.top.setColor(e)}},{key:"setRColor",value:function(e){this.right.setColor(e)}},{key:"setBColor",value:function(e){this.bottom.setColor(e)}},{key:"setAllWidthType",value:function(e){this.setBWidthType(e),this.setLWidthType(e),this.setTWidthType(e),this.setRWidthType(e)}},{key:"setLWidthType",value:function(e){this.left.setWidthType(e)}},{key:"setTWidthType",value:function(e){this.top.setWidthType(e)}},{key:"setRWidthType",value:function(e){this.right.setWidthType(e)}},{key:"setBWidthType",value:function(e){this.bottom.setWidthType(e)}},{key:"setAllType",value:function(e){this.setBType(e),this.setLType(e),this.setTType(e),this.setRType(e)}},{key:"setLType",value:function(e){this.left.setType(e)}},{key:"setTType",value:function(e){this.top.setType(e)}},{key:"setRType",value:function(e){this.right.setType(e)}},{key:"setBType",value:function(e){this.bottom.setType(e)}},{key:"updateMaxIndex",value:function(){var e=qe.getZIndex();this.left.setZIndex(e),this.bottom.setZIndex(e),this.top.setZIndex(e),this.right.setZIndex(e)}},{key:"clone",value:function(){var t=this.left,n=this.top,r=this.right,i=this.bottom;return new e({left:t.clone(),top:n.clone(),right:r.clone(),bottom:i.clone()})}}])&&$e(t.prototype,n),r&&$e(t,r),e}();function Je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ke.EMPTY=new Ke,Ke.getInstance=function(e){return e?new Ke(e):Ke.EMPTY};var Qe=function(){function e(t){var n=t.x,r=t.y,i=t.width,o=t.height;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=n,this.y=r,this.width=i,this.height=o}var t,n,r;return t=e,(n=[{key:"disjoint",value:function(e){return this.x>e.x+e.width||this.y>this.y+e.height||e.x>this.x+this.width||e.y>this.y+this.height}},{key:"expandSize",value:function(e){return this.width+=e,this.height+=e,this}},{key:"includePoint",value:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}},{key:"includeRect",value:function(e){var t=e.x,n=e.y,r=e.width,i=e.height;return this.x<=t&&this.x+this.width>=t+r&&this.y<=n&&this.y+this.height>=n+i}},{key:"inRectPosition",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y,width:this.width,height:this.height})}},{key:"clone",value:function(){return new e({x:this.x,y:this.y,width:this.width,height:this.height})}}])&&Je(t.prototype,n),r&&Je(t,r),e}();function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var tt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.x,r=void 0===n?0:n,i=t.y,o=void 0===i?0:i;et(this,e),this.x=r,this.y=o};function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var rt=function(){function e(t){var n=t.rect,r=t.draw,i=t.offset,o=void 0===i?0:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rect=n,this.draw=r,this.offset=o}var t,n,r;return t=e,(n=[{key:"open",value:function(){var e=this.rect,t=this.draw,n=this.offset,r=e.x,i=e.y,o=e.width,a=e.height;return t.save().rect(r,i,o+n,a+n).clip().beginPath(),this}},{key:"close",value:function(){return this.draw.restore(),this}}])&&nt(t.prototype,n),r&&nt(t,r),e}();function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ot(e,t,n){return t&&it(e.prototype,t),n&&it(e,n),e}var at=function(){function e(t){var n=t.vertical,r=void 0===n?e.ICON_VERTICAL.CENTER:n,i=t.horizontal,o=void 0===i?e.ICON_HORIZONTAL.RIGHT:i,a=t.type,s=void 0===a?e.ICON_TYPE.image:a,u=t.image,l=void 0===u?c.Nul:u,h=t.iconFocus,f=void 0===h?null:h,v=t.height,y=void 0===v?16:v,d=t.width,p=void 0===d?16:d,g=t.color,m=void 0===g?"rgb(255,255,255)":g,b=t.offset,k=void 0===b?{x:0,y:0}:b,x=t.onDraw,w=void 0===x?function(){}:x,T=t.onLeave,E=void 0===T?function(){}:T,O=t.onMove,C=void 0===O?function(){}:O,A=t.onDown,N=void 0===A?function(){}:A,_=t.onEnter,I=void 0===_?function(){}:_;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vertical=r,this.horizontal=o,this.width=p,this.height=y,this.type=s,this.image=l,this.color=m,this.iconFocus=f,this.offset=new tt(k),this.onLeave=E,this.onMove=C,this.onDraw=w,this.onDown=N,this.onEnter=I,this.rect=null}return ot(e,null,[{key:"newInstances",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[],r=0;r<t.length;r+=1){var i=t[r];n.push(new e(i))}return n}}]),ot(e,[{key:"position",value:function(t){var n=this.horizontal,r=this.vertical,i=je.stylePx(this.offset.x),o=je.stylePx(this.offset.y),a=je.stylePx(this.width),s=je.stylePx(this.height),u=t.x,c=t.y,l=t.width,h=t.height,f=0,v=0;switch(n){case e.ICON_HORIZONTAL.CENTER:f=u+l/2-a/2;break;case e.ICON_HORIZONTAL.LEFT:f=u;break;case e.ICON_HORIZONTAL.RIGHT:f=u+l-a}switch(r){case e.ICON_VERTICAL.CENTER:v=c+h/2-s/2;break;case e.ICON_VERTICAL.TOP:v=c;break;case e.ICON_VERTICAL.BOTTOM:v=c+h-s}return new Qe({x:f+=i,y:v+=o,width:a,height:s})}},{key:"loadImage",value:function(t){var n=this,r=t.load,i=t.sync,o=this.image;switch(this.type){case e.ICON_TYPE.image:if(o instanceof Image)i(o);else{var a=new Image;a.src=o,a.complete?(this.image=a,i(this.image)):(a.onload=function(){n.image=a,r(a)},a.onerror=function(){console.error("图片加载失败".concat(o))})}break;case e.ICON_TYPE.draw:i()}}},{key:"drawIcon",value:function(t){var n=t.rect,r=t.draw,i=this.type;switch(this.rect=n,i){case e.ICON_TYPE.image:this.drawImage({rect:n,draw:r});break;case e.ICON_TYPE.draw:this.drawCustom({rect:n,draw:r})}}},{key:"drawCustom",value:function(e){var t=e.rect,n=e.draw;this.onDraw({rect:t,draw:n})}},{key:"drawImage",value:function(e){var t=e.rect,n=e.draw,r=this.image,i=this.color,o=this.position(t),a=o.x,s=o.y,u=o.width,c=o.height,l=t.includeRect(o),h=new rt({rect:t,draw:n});!1===l&&h.open(),i&&(n.attr({fillStyle:i}),n.fillRect(a,s,u,c)),n.drawImage(r,0,0,r.width,r.height,a,s,u,c),!1===l&&h.close()}},{key:"eventHandle",value:function(t){var n=t.type,r=t.x,i=t.y,o=t.native,a=this.rect,s=this.iconFocus;if(a){var u=this.position(a),c=u.inRectPosition(a),l=s.activate;switch(n){case e.ICON_EVENT_TYPE.MOUSE_DOWN:c.includePoint(r,i)&&(s.setActivate(this),this.onDown({native:o,position:u}));break;case e.ICON_EVENT_TYPE.MOUSE_MOVE:c.includePoint(r,i)?(l!==this&&this.onEnter({native:o,position:u}),s.setActivate(this),this.onMove({native:o,position:u})):l&&(s.setActivate(null),this.onLeave({native:o,position:u}))}}}},{key:"setOnDraw",value:function(e){this.onDraw=e}},{key:"setOnDown",value:function(e){this.onDown=e}},{key:"setOnMove",value:function(e){this.onMove=e}},{key:"setOnEnter",value:function(e){this.onEnter=e}},{key:"setOnLeave",value:function(e){this.onLeave=e}},{key:"setFocus",value:function(e){this.iconFocus=e}}]),e}();function st(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}at.ICON_HORIZONTAL={LEFT:0,RIGHT:1,CENTER:2},at.ICON_VERTICAL={TOP:3,BOTTOM:4,CENTER:5},at.ICON_TYPE={image:1,custom:2},at.ICON_EVENT_TYPE={MOUSE_DOWN:1,MOUSE_MOVE:2},at.EMPTY=[],at.getInstance=function(e){return e?at.newInstances(e):at.EMPTY};var ut=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"dateFormat",value:function(e,t){if(!(t instanceof Date))return t;var n={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()},r=/(y+)/.exec(e);if(r){var i=r[0],o=t.getFullYear().toString().substr(4-i.length);e=e.replace(i,o)}for(var a in n){var s=new RegExp("(".concat(a,")")).exec(e);if(s){var u=n[a].toString(),c=s[0],l=1===c.length?u:"00".concat(u).substr(u.length);e=e.replace(c,l)}}return e}},{key:"parse",value:function(t){var n=t;return n instanceof Date||(n=e.parserToDate(t,"yyyy/MM/dd"))||(n=e.parserToDate(t,"MM/dd"))||(n=e.parserToDate(t,"yyyy/MM/dd hh:mm:ss"))||(n=e.parserToDate(t,"yyyy-MM-dd"))||(n=e.parserToDate(t,"MM-dd"))||(n=e.parserToDate(t,"yyyy-MM-dd hh:mm:ss"))||(n=e.parserToDate(t,"hh:mm:ss"))||(n=e.parserToDate(t,"yyyy年MM月"))||(n=e.parserToDate(t,"MM月dd日"))?n:(n=e.parserToDate(t,"yyyy年MM月dd日 hh:mm:ss"))||t}},{key:"parserToDate",value:function(e,t){if(!e)return null;for(var n=new Date("1970/01/01 00:00:00"),r=[{reg:"y+"},{reg:"M+"},{reg:"d+"},{reg:"h+"},{reg:"m+"},{reg:"s+"},{reg:"S"}],i=n.getFullYear(),o=n.getMonth()+1,a=n.getDate(),s=n.getHours(),u=n.getMinutes(),c=n.getSeconds(),l=n.getMilliseconds(),h=1,f=0;f<t.length;f+=1)for(var v=t[f],y=0;y<r.length;y+=1){var d=r[y];if(d.reg[0]===v){d.index||(d.index=h,h+=1);break}}for(var p=0;p<r.length;p+=1){var g=r[p].reg,m=new RegExp("(".concat(g,")")).exec(t);if(m){var b=m[0],k="([0-9]{1,".concat(b.length,"})");t=t.replace(b,k)}}var x={},w=new RegExp(t).exec(e);if(!w)return null;for(var T=1;T<w.length;T+=1)x[T]=w[T];return r[0].index&&(i=x[r[0].index]),r[1].index&&(o=x[r[1].index]),r[2].index&&(a=x[r[2].index]),r[3].index&&(s=x[r[3].index]),r[4].index&&(u=x[r[4].index]),r[5].index&&(c=x[r[5].index]),r[6].index&&(l=x[r[6].index]),new Date(i,o-1,a,s,u,c,l)}}],(n=null)&&st(t.prototype,n),r&&st(t,r),e}();function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var lt=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"default",value:function(e){return this.text(e)}},{key:"text",value:function(e){return e?"".concat(e):""}},{key:"number",value:function(e){return this.text(e)}},{key:"fraction",value:function(e){if(c.isFraction(e)){var t=e.split("/")[0],n=e.split("/")[1];return this.text(c.parseInt(t)/c.parseInt(n))}return this.text(e)}},{key:"eNotation",value:function(e){return c.isNumber(e)?c.parseFloat(e).toExponential(2):this.text(e)}},{key:"decimal",value:function(e){if(c.isNumber(e)){var t=e.toString().indexOf(".");return-1!==t?e.toString().substring(0,t+3):"".concat(e,".00")}return this.text(e)}},{key:"percentage",value:function(e){return c.isNumber(e)?"".concat(e,"%"):this.text(e)}},{key:"rmb",value:function(e){return c.isNumber(e)?"￥".concat(e):this.text(e)}},{key:"hk",value:function(e){return c.isNumber(e)?"HK".concat(e):this.text(e)}},{key:"dollar",value:function(e){return c.isNumber(e)?"$".concat(e):this.text(e)}},{key:"time",value:function(e){var t=ut.parse(e);return t?ut.dateFormat("hh:mm:ss",t):this.text(e)}},{key:"date1",value:function(e){var t=ut.parse(e);return t?ut.dateFormat("yyyy/MM/dd",t):this.text(e)}},{key:"date2",value:function(e){var t=ut.parse(e);return t?ut.dateFormat("MM月dd日",t):this.text(e)}},{key:"date3",value:function(e){var t=ut.parse(e);return t?ut.dateFormat("yyyy年MM月",t):this.text(e)}},{key:"date4",value:function(e){var t=ut.parse(e);return t?ut.dateFormat("yyyy年MM月dd日",t):this.text(e)}},{key:"date5",value:function(e){var t=ut.parse(e);return t?ut.dateFormat("yyyy/MM/dd hh:mm:ss",t):this.text(e)}}])&&ct(t.prototype,n),r&&ct(t,r),e}()),ht=function(e,t){return lt[e](t)};function ft(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var yt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.text,r=void 0===n?"":n,i=t.color,o=void 0===i?ve.BLACK:i,a=t.name,s=void 0===a?"Arial":a,u=t.size,c=void 0===u?14:u,l=t.bold,h=void 0!==l&&l,f=t.italic,v=void 0!==f&&f,y=t.strikethrough,d=void 0!==y&&y,p=t.underline,g=void 0!==p&&p,m=t.scaleAdapter;ft(this,e),this.color=o,this.text="".concat(r),this.name=s,this.size=c,this.italic=v,this.bold=h,this.strikethrough=d,this.underline=g,this.scaleAdapter=m}var t,n,r;return t=e,(n=[{key:"clone",value:function(){return new e({text:this.text,color:this.color,name:this.name,size:this.size,italic:this.italic,bold:this.bold,underline:this.underline,strikethrough:this.strikethrough,scaleAdapter:this.scaleAdapter})}},{key:"reset",value:function(){this.color=ve.BLACK,this.name="Arial",this.size=14,this.bold=!1,this.italic=!1,this.strikethrough=!1,this.underline=!1}},{key:"plain",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return e(this.clone())}},{key:"like",value:function(e){for(var t=["scaleAdapter"],n=Object.keys(this),r=Object.keys(e),i=0,o=r;i<o.length;i++){var a=o[i];if(!t.includes(a)&&!n.includes(a))return!1}for(var s=0,u=r;s<u.length;s++){var l=u[s];if(!t.includes(l)){var h=this[l],f=e[l];switch(l){case"color":h=c.clearBlank(h),f=c.clearBlank(f)}if(h!==f)return!1}}return!0}},{key:"equals",value:function(e){for(var t=["scaleAdapter"],n=Object.keys(this),r=Object.keys(e),i=0,o=n;i<o.length;i++){var a=o[i];if(!t.includes(a)&&!r.includes(a))return!1}for(var s=0,u=n;s<u.length;s++){var l=u[s];if(!t.includes(l)){var h=this[l],f=e[l];switch(l){case"color":h=c.clearBlank(h),f=c.clearBlank(f)}if(h!==f)return!1}}return!0}}])&&vt(t.prototype,n),r&&vt(t,r),e}();function dt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var gt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.rich,r=void 0===n?[]:n;dt(this,e),this.rich=r.map((function(e){return new yt(e)}))}var t,n,r;return t=e,(n=[{key:"setRich",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.rich=e}},{key:"each",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.rich.forEach((function(t){e(t)}))}},{key:"reset",value:function(){this.each((function(e){e.reset()}))}},{key:"getRich",value:function(){return this.rich}},{key:"clone",value:function(){var t=[];return this.rich.forEach((function(e){t.push(e.clone())})),new e({rich:t})}},{key:"hasLength",value:function(){return this.rich.length>0}},{key:"plain",value:function(e){var t=[];return this.rich.forEach((function(n){t.push(n.plain(e))})),t}},{key:"like",value:function(e){if(c.isUnDef(e))return!1;if(e.rich.length!==this.rich.length)return!1;for(var t=0;t<this.rich.length;t++){var n=this.rich[t],r=e.rich[t];if(!n.like(r))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.each((function(t){return e.push(t.text)})),e.join("")}},{key:"equals",value:function(e){if(c.isUnDef(e))return!1;if(e.rich.length!==this.rich.length)return!1;for(var t=0;t<this.rich.length;t++){var n=this.rich[t],r=e.rich[t];if(!n.equals(r))return!1}return!0}}])&&pt(t.prototype,n),r&&pt(t,r),e}();function mt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kt(e,t,n){return t&&bt(e.prototype,t),n&&bt(e,n),e}gt.EMPTY=new gt,gt.getInstance=function(e){return e?new gt(e):gt.EMPTY};var xt=new(function(){function e(){mt(this,e),this.functions={}}return kt(e,[{key:"remove",value:function(e){delete this.functions[e]}},{key:"getFunction",value:function(e){return this.functions[e.toLocaleString()]}},{key:"register",value:function(e,t){this.functions[e.toLocaleString()]=t}}]),e}()),wt=function(){function e(){mt(this,e),this.assembly=""}return kt(e,[{key:"getInstruct",value:function(){for(var e=this.assembly;e.endsWith("\r\n");){var t=e.length;e=e.substring(0,t-"\r\n".length)}return e}},{key:"writeOperand",value:function(e){this.assembly+="OPush ".concat(e,"\r\n")}},{key:"writeOperator",value:function(e){this.assembly+="".concat(e,"\r\n")}},{key:"writeString",value:function(e){this.assembly+="SPush ".concat(e,"\r\n")}},{key:"writeNumber",value:function(e){this.assembly+="NPush ".concat(e,"\r\n")}}]),e}(),Tt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.syntaxCheck,r=void 0===n||n;mt(this,e),this.syntaxCheck=r}return kt(e,[{key:"lexical",value:function(e){for(var t=/^(\+|-|\*|\/|%|>|<|,|\^|=|&|!|:|>=|<=|<>)$/,n=/[0-9.]/,r=/\s/,i=/[a-z0-9_$]/i,o=e.length,a=[],s=0,u=[];s<o;){var c=e[s];if(r.test(c)){var l=e[s+1];if(r.test(l)){s++;continue}}if(r.test(c)){var h=e[s-1],f=e[s+1];i.test(h)&&i.test(f)&&u.push({type:"operator",value:c}),s++}else if("("!==c)if(")"!==c)if("{"!==c)if("}"!==c)if('"'!==c)if("'"!==c)if(t.test(c)){var v=e[s+1],y="".concat(c).concat(v);t.test(y)?(u.push({type:"operator",value:y}),s++):u.push({type:"operator",value:c}),s++}else if(n.test(c)){for(var d="";n.test(c)&&s<o;)d+=c,c=e[++s];u.push({type:"number",value:d})}else{if(!i.test(c))throw new TypeError("无法识别的token ".concat(c," "));for(var p="";i.test(c)&&s<o;)p+=c,c=e[++s];"("===c?(u.push({type:"function",value:p}),u.push({type:"function",value:"("}),a.push({type:"function",value:"("}),s++):u.push({type:"operand",value:p})}else{var g="";for(c=e[++s];"'"!==c&&s<o;)g+=c,c=e[++s];c=e[++s],u.push({type:"string",value:g})}else{var m="";for(c=e[++s];'"'!==c&&s<o;)m+=c,c=e[++s];c=e[++s],u.push({type:"string",value:m})}else u.push({type:"array",value:"}"}),s++;else u.push({type:"array",value:"array"}),u.push({type:"array",value:"{"}),s++;else{var b=a.pop();b&&"function"===b.type?u.push({type:"function",value:")"}):u.push({type:"brackets",value:")"}),s++}else u.push({type:"brackets",value:"("}),a.push({type:"brackets",value:"("}),s++}return this.syntaxCheck?this.syntax(u):u}},{key:"syntax",value:function(e){for(var t=[],n=[],r=[],i=[],o=[],a=0,s=e.length,u=function(e){return"array"===e.type&&"array"===e.value},c=function(e){return"function"===e.type&&("("!==e.value&&")"!==e.value)},l=function(t,n){if("last"===t)for(;n>=0;){var r=e[n];if(c(r))n--;else{if(!u(r))return r;n--}}if("next"===t)for(;n<s;){var i=e[n];if(c(i))n++;else{if(!u(i))return i;n++}}return null},h=function(t,n){var r=e[a],i="last"===t?"前面":"后面";if("{"===r.value){if("last"===t)switch(n.type){case"array":if("{"===n.value)return;break;case"function":case"brackets":if("("===n.value)return;break;case"operator":return void n.value}if("next"===t)switch(n.type){case"string":case"array":case"number":case"operand":return;case"function":case"brackets":if("("===n.value)return}}if("}"===r.value){if("last"===t)switch(n.type){case"number":case"string":case"array":case"operand":return;case"function":case"brackets":if(")"===n.value)return}if("next"===t)switch(n.type){case"array":if("}"===n.value)return;break;case"function":case"brackets":if(")"===n.value)return;break;case"operator":return void n.value}}throw TypeError("错误表达式 ".concat(r.value," ").concat(i," ").concat(n.value))},f=function(t,n){var r=e[a],i="last"===t?"前面":"后面";switch(n.type){case"array":if("last"===t&&"{"===n.value)return;if("next"===t&&"}"===n.value)return;break;case"brackets":case"function":if("last"===t&&"("===n.value)return;if("next"===t&&")"===n.value)return;break;case"operator":return}throw TypeError("错误表达式 ".concat(r.value," ").concat(i," ").concat(n.value))},v=function(t,n){var r=e[a],i="last"===t?"前面":"后面";switch(n.type){case"brackets":case"function":case"string":case"number":case"operand":return;case"array":if(","===r.value)return}throw TypeError("错误表达式 ".concat(r.value," ").concat(i," ").concat(n.value))},y=function(t,n){var r=e[a],i="last"===t?"前面":"后面";if("("===r.value){if("last"===t)switch(n.type){case"array":if("{"===n.value)return;break;case"function":case"brackets":if("("===n.value)return;break;case"operator":return}if("next"===t)switch(n.type){case"function":case"string":case"number":case"operand":return;case"array":if("{"===n.value)return;break;case"brackets":if("("===n.value)return}}if(")"===r.value){if("last"===t)switch(n.type){case"function":case"number":case"string":case"operand":return;case"array":if("}"===n.value)return;break;case"brackets":if(")"===n.value)return}if("next"===t)switch(n.type){case"array":if("}"===n.value)return;break;case"function":case"brackets":if(")"===n.value)return;break;case"operator":return void n.value}}throw TypeError("错误表达式 ".concat(r.value," ").concat(i," ").concat(n.value))};a<s;){var d=e[a];if(u(d))a++;else if(c(d))a++;else{var p=d.type,g=d.value;if("'"===p&&(t.length?t.pop():n.length||t.push("'")),'"'===p&&(n.length?n.pop():t.length||n.push('"')),"string"===p){var m=l("last",a-1),b=l("next",a+1);m&&f("last",m),b&&f("next",b)}if("number"===p){var k=l("last",a-1),x=l("next",a+1);k&&f("last",k),x&&f("next",x)}if("array"===p){if("{"===g&&i.push(d),"}"===g){if(0===i.length)throw new TypeError("数组缺少闭合标签");i.pop()}var w=l("last",a-1),T=l("next",a+1);w&&h("last",w),T&&h("next",T)}if("function"===p){"("===g&&r.push(d),")"===g&&r.pop();var E=l("last",a-1),O=l("next",a+1);E&&y("last",E),O&&y("next",O)}if("operator"===p){var C=l("last",a-1),A=l("next",a+1);if(!C)throw TypeError("错误表达式: ".concat(d.value," 错误"));if(v("last",C),!A)throw TypeError("错误表达式: ".concat(d.value," 错误"));v("next",A)}if("brackets"===p&&("("===g&&o.push(d),")"===g)){if(0===o.length)throw new TypeError("括号缺少闭合标签");o.pop()}a++}}if(i.length)throw new TypeError("数组缺少闭合标签");if(r.length)throw new TypeError("函数缺少闭合标签");if(t.length)throw new TypeError("单引号缺少闭合标签");if(n.length)throw new TypeError("双引号缺少闭合标签");if(o.length)throw new TypeError("括号缺少闭合标签");return e}}]),e}(),Et=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.tokens,r=t.writer;mt(this,e),this.writer=r,this.tokens=n,this.groupStack=[],this.index=-1,this.ignore=[","],this.opIf={">":"ifge","<":"ifgt","=":"ifeq",">=":"if_icmpge","<=":"if_icmpgt","<>":"ifne"},this.opAdd={"+":"add","-":"sub","&":"link"},this.opMul={"*":"mul","/":"div","%":"mod","^":"power"},this.opCommon={" ":"common"},this.opRel={"!":"rel",":":"uni"},this.opNew={array:"newarray"},this.opCell={function:"invoke"}}return kt(e,[{key:"eofToken",value:function(){return this.index>=this.tokens.length-1}},{key:"nextToken",value:function(){return this.index++,this.token=this.tokens[this.index],this.token}},{key:"backToken",value:function(){return this.index--,this.token=this.tokens[this.index],this.token}},{key:"reduceGroup",value:function(){var e=this.groupStack,t=e.length;if(t>0){var n=e[t-1],r=n.number;n.number=r-1}}},{key:"increaseGroup",value:function(){var e=this.groupStack,t=e.length;if(t>0){var n=e[t-1],r=n.number;n.number=r+1}}},{key:"popGroup",value:function(){return this.groupStack.pop()}},{key:"addGroup",value:function(e){return e.number=0,this.groupStack.push(e),e}},{key:"isSkipNextToken",value:function(){if(!this.eofToken()){var e=this.ignore;this.nextToken();var t=this.token;this.backToken();var n=t.value;return e.includes(n)}return!1}},{key:"compile",value:function(){var e=this.writer;for(this.compileIfge();this.isSkipNextToken();)this.nextToken(),this.compileIfge();return e.getInstruct()}},{key:"compileIfge",value:function(){for(this.compileAdd();!this.eofToken();){var e=this.nextToken(),t=e.type,n=e.value;if("operator"!==t){this.backToken();break}if(!this.opIf[n]){this.backToken();break}var r=this.opIf[n];this.compileAdd(),this.reduceGroup(),this.writer.writeOperator(r)}}},{key:"compileAdd",value:function(){for(this.compileMul();!this.eofToken();){var e=this.nextToken(),t=e.type,n=e.value;if("operator"!==t){this.backToken();break}if(!this.opAdd[n]){this.backToken();break}var r=this.opAdd[n];this.compileMul(),this.reduceGroup(),this.writer.writeOperator(r)}}},{key:"compileMul",value:function(){for(this.compileCommon();!this.eofToken();){var e=this.nextToken(),t=e.type,n=e.value;if("operator"!==t){this.backToken();break}if(!this.opMul[n]){this.backToken();break}var r=this.opMul[n];this.compileCommon(),this.reduceGroup(),this.writer.writeOperator(r)}}},{key:"compileCommon",value:function(){for(this.compileRel();!this.eofToken();){var e=this.nextToken(),t=e.type,n=e.value;if("operator"!==t){this.backToken();break}if(!this.opCommon[n]){this.backToken();break}var r=this.opCommon[n];this.compileRel(),this.reduceGroup(),this.writer.writeOperator(r)}}},{key:"compileRel",value:function(){for(this.compileArray();!this.eofToken();){var e=this.nextToken(),t=e.type,n=e.value;if("operator"!==t){this.backToken();break}if(!this.opRel[n]){this.backToken();break}var r=this.opRel[n];this.compileArray(),this.reduceGroup(),this.writer.writeOperator(r)}}},{key:"compileArray",value:function(){for(this.compileFunction();!this.eofToken();){var e=this.nextToken(),t=e.type,n=e.value;if("array"!==t){this.backToken();break}if("}"===n){this.backToken();break}for(this.addGroup(e),this.nextToken(),this.compileIfge();this.isSkipNextToken();)this.nextToken(),this.compileIfge();this.popGroup();var r=e.number,i=this.opNew[t];this.writer.writeOperator("".concat(i," ").concat(r)),this.nextToken()}}},{key:"compileFunction",value:function(){for(this.compilePushValue();!this.eofToken();){var e=this.nextToken(),t=e.type,n=e.value;if("function"!==t){this.backToken();break}if(")"===n){this.backToken();break}for(this.addGroup(e),this.nextToken(),this.compileIfge();this.isSkipNextToken();)this.nextToken(),this.compileIfge();this.popGroup();var r=e.number,i=this.opCell[t];this.writer.writeOperator("".concat(i," ").concat(n," ").concat(r)),this.nextToken()}}},{key:"compilePushValue",value:function(){if(!this.eofToken()){var e=this.nextToken(),t=this.writer,n=e.type,r=e.value;switch(n){case"string":return this.increaseGroup(),void t.writeString("".concat(r));case"number":return this.increaseGroup(),void t.writeNumber("".concat(r));case"operand":return this.increaseGroup(),void t.writeOperand(r)}switch(n){case"brackets":if("("===r){for(this.compileIfge();this.isSkipNextToken();)this.nextToken(),this.compileIfge();this.nextToken()}return}switch(n){case"array":return"}"!==r&&this.increaseGroup(),void this.backToken();case"function":return")"!==r&&this.increaseGroup(),void this.backToken()}switch(n){case"operator":return void this.backToken()}throw new TypeError("无法识别的token ".concat(n," ").concat(r," "))}}}]),e}(),Ot=function(){function e(t){mt(this,e),this.instruct=t.split("\r\n"),this.memory=[]}return kt(e,[{key:"eval",value:function(){var e=this,t=/^newarray/,n=/^invoke/,r=/^SPush/,i=/^NPush/,o=/^OPush/;return this.instruct.forEach((function(a){switch(a){case"if_icmpge":e.ificmpge();break;case"if_icmpgt":e.ificmpgt();break;case"ifge":e.ifge();break;case"ifgt":e.ifgt();break;case"ifeq":e.ifeq();break;case"ifne":e.ifne();break;case"add":e.add();break;case"sub":e.sub();break;case"mul":e.mul();break;case"div":e.div();break;case"mod":e.mod();break;case"power":e.power();break;case"rel":e.rel();break;case"link":e.link();break;case"uni":e.uni();break;case"common":e.common();break;default:if(t.test(a)){var s=a.split(" ")[1];e.array(s);break}if(n.test(a)){var u=a.split(" "),c=u[1],l=u[2];e.invoke(c,l);break}if(r.test(a)){var h=a.split(" ")[1];e.pushS(h);break}if(i.test(a)){var f=a.split(" ")[1];e.pushN(f);break}if(o.test(a)){var v=a.split(" ")[1];e.pushO(v);break}}})),this.memory.pop()}},{key:"pushS",value:function(e){this.memory.push(e)}},{key:"pushN",value:function(e){e=parseFloat(e),this.memory.push(e)}},{key:"pushO",value:function(e){this.memory.push(e)}},{key:"ifge",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t>e)}},{key:"ifgt",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t<e)}},{key:"ifeq",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t===e)}},{key:"ifne",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t!==e)}},{key:"ificmpge",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t>=e)}},{key:"ificmpgt",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t<=e)}},{key:"add",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t+e)}},{key:"sub",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t-e)}},{key:"mul",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t*e)}},{key:"div",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t/e)}},{key:"mod",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(t%e)}},{key:"common",value:function(){}},{key:"rel",value:function(){}},{key:"uni",value:function(){}},{key:"link",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push("".concat(t).concat(e))}},{key:"power",value:function(){var e=this.memory.pop(),t=this.memory.pop();this.memory.push(Math.pow(t,e))}},{key:"array",value:function(e){for(var t=[],n=1;n<=e;n++){var r=this.memory.pop();t.push(r)}t.reverse(),this.memory.push(t)}},{key:"invoke",value:function(e,t){for(var n=[],r=1;r<=t;r++){var i=this.memory.pop();n.push(i)}n.reverse();var o=xt.getFunction(e).apply(this,n);this.memory.push(o)}}]),e}(),Ct=function(e){e.startsWith("=")&&(e=e.substring(1));var t=new Tt,n=new wt,r=t.lexical(e);return new Et({writer:n,tokens:r}).compile()},At=function(e){return new Ot(e).eval()};function Nt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var It=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.expr,r=void 0===n?c.EMPTY:n;Nt(this,e),this.expr=r,this.content=c.Nul,this.instruct=c.Nul}var t,n,r;return t=e,(n=[{key:"getValue",value:function(){var e=this.expr,t=this.content,n=this.instruct;return t||(n||(n=Ct(e)),t=At(n)),this.content=t,this.instruct=n,t}},{key:"hasExpr",value:function(){var e=this.expr;return!c.isBlank(e)}},{key:"getExpr",value:function(){return this.expr}},{key:"setExpr",value:function(e){this.expr=e,this.content=c.Nul,this.instruct=c.Nul}},{key:"clone",value:function(){return new e({expr:this.expr})}}])&&_t(t.prototype,n),r&&_t(t,r),e}();function St(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}It.EMPTY=new It,It.getInstance=function(e){return e?new It(e):It.EMPTY};var Rt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.borderAttr,r=void 0===n?c.Undef:n,i=t.fontAttr,o=void 0===i?c.Undef:i,a=t.richText,s=void 0===a?c.Undef:a,u=t.formula,l=void 0===u?c.Undef:u,h=t.background,f=void 0===h?c.Undef:h,v=t.text,y=void 0===v?c.EMPTY:v,d=t.custom,p=void 0===d?{}:d,g=t.icons,m=void 0===g?[]:g,b=t.ruler,k=void 0===b?c.Undef:b,x=t.contentWidth,w=void 0===x?0:x,T=t.contentHeight,E=void 0===T?0:T,O=t.format,C=void 0===O?"default":O,A=t.contentType,N=void 0===A?e.TYPE.STRING:A;St(this,e),this.background=f,this.icons=at.getInstance(m),this.custom=p,this.ruler=k,this.format=C,this.formula=It.getInstance(l),this.text=y,this.richText=gt.getInstance(s),this.formatText=c.EMPTY,this.contentWidth=w,this.contentHeight=E,this.fontAttr=pe.getInstance(o),this.borderAttr=Ke.getInstance(r),this.setContentType(N)}var t,n,r;return t=e,(n=[{key:"setIcons",value:function(e){return this.icons=e,this}},{key:"setText",value:function(e){return this.formatText=null,this.text=e,this.formula.setExpr(null),this.richText.setRich([]),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichText",value:function(e){return this.formatText=null,this.text=null,this.formula.setExpr(null),this.richText.setRich(e),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setExpr",value:function(e){return this.formatText=null,this.text=null,this.formula.setExpr(e),this.richText.setRich([]),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"getExpr",value:function(){return this.formula.getExpr()}},{key:"setFormat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this.format=e,this.formatText=null,this.clearRuler(),this.setContentWidth(0),this}},{key:"setRuler",value:function(e){return this.ruler=e,this}},{key:"setContentType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.TYPE.STRING,n=this.text;switch(t){case e.TYPE.STRING:this.contentType=e.TYPE.STRING;break;case e.TYPE.NUMBER:this.contentType=t,c.isNumber(n)?(this.contentType=e.TYPE.NUMBER,this.text=c.parseFloat(n)):(this.contentType=e.TYPE.STRING,this.text="".concat(n));break;case e.TYPE.DATE_TIME:var r=ut.parse(n);c.isDate(r)?(this.contentType=e.TYPE.DATE_TIME,this.text=n):(this.contentType=e.TYPE.STRING,this.text="".concat(n));break;case e.TYPE.RICH_TEXT:this.contentType=e.TYPE.RICH_TEXT}return this}},{key:"isEmpty",value:function(){return c.isBlank(this.getComputeText())}},{key:"hasFormula",value:function(){return this.formula.hasExpr()}},{key:"getFormatText",value:function(){var t=this.text,n=this.formula,r=this.format,i=this.formatText,o=this.contentType;if(n.hasExpr()){var a=n.getValue();return a&&c.isBlank(i)&&(i=ht(r,a)),this.formatText=i,i}switch(o){case e.TYPE.STRING:case e.TYPE.NUMBER:case e.TYPE.DATE_TIME:return r&&c.isBlank(i)?(this.formatText=ht(r,t),this.formatText):i}return c.EMPTY}},{key:"getComputeText",value:function(){var t=this.text,n=this.formula,r=this.richText,i=this.contentType;if(n.hasExpr())return n.getValue();switch(i){case e.TYPE.STRING:case e.TYPE.NUMBER:case e.TYPE.DATE_TIME:return t;case e.TYPE.RICH_TEXT:return r}return c.EMPTY}},{key:"setFontAttr",value:function(e){return this.fontAttr=e,this}},{key:"setBorderAttr",value:function(e){return this.borderAttr=e,this}},{key:"clone",value:function(){return new e(this)}},{key:"cloneStyle",value:function(){return new e({borderAttr:this.borderAttr,fontAttr:this.fontAttr,background:this.background})}},{key:"toJSON",value:function(){var e=this.background,t=this.text,n=this.format,r=this.custom,i=this.icons,o=this.contentType,a=this.formula;return{custom:r,richText:this.richText,formula:a,contentType:o,text:t,icons:i,background:e,format:n,fontAttr:this.fontAttr,borderAttr:this.borderAttr}}},{key:"toString",value:function(){return this.getFormatText()}},{key:"setContentWidth",value:function(e){return this.contentWidth=e,this}},{key:"setContentHeight",value:function(e){return this.contentHeight=e,this}},{key:"setTextWrap",value:function(e){return this.fontAttr.textWrap=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontColor",value:function(e){return this.fontAttr.color=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichFontColor",value:function(e){return this.richText.each((function(t){t.color=e})),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontSize",value:function(e){return this.fontAttr.size=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichFontSize",value:function(e){return this.richText.each((function(t){t.size=e})),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontBold",value:function(e){return this.fontAttr.bold=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichFontBold",value:function(e){return this.richText.each((function(t){t.bold=e})),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontItalic",value:function(e){return this.fontAttr.italic=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichFontItalic",value:function(e){return this.richText.each((function(t){t.italic=e})),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontName",value:function(e){return this.fontAttr.name=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichFontName",value:function(e){return this.richText.each((function(t){t.name=e})),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setUnderLine",value:function(e){return this.fontAttr.underline=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichUnderLine",value:function(e){return this.richText.each((function(t){t.underline=e})),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setStrikeLine",value:function(e){return this.fontAttr.strikethrough=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setRichStrikeLine",value:function(e){return this.richText.each((function(t){t.strikethrough=e})),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontAngle",value:function(e){return 0===e?(this.fontAttr.angle=e,this.fontAttr.direction=h.TEXT_DIRECTION.HORIZONTAL):(this.borderAttr.updateMaxIndex(),this.fontAttr.angle=e,this.fontAttr.direction=h.TEXT_DIRECTION.ANGLE),this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontDirection",value:function(e){return this.fontAttr.angle=0,this.fontAttr.direction=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setBackground",value:function(e){return this.background=e,this}},{key:"setFontAlign",value:function(e){return this.fontAttr.align=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}},{key:"setFontVerticalAlign",value:function(e){return this.fontAttr.verticalAlign=e,this.setRuler(null),this.setContentWidth(0),this.setContentHeight(0),this}}])&&Pt(t.prototype,n),r&&Pt(t,r),e}();function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Rt.TYPE={NUMBER:0,STRING:1,RICH_TEXT:2,DATE_TIME:3};var Yt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pool={}}var t,n,r;return t=e,(n=[{key:"clear",value:function(){var e=this;Object.keys((function(t){delete e.pool[t]}))}},{key:"removeListen",value:function(e){delete this.pool[e]}},{key:"registerListen",value:function(e,t){this.pool[e]=t}},{key:"execute",value:function(e){if(this.pool[e]){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.pool)[e].apply(t,r)}}}])&&Mt(t.prototype,n),r&&Mt(t,r),e}();function Xt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return jt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Wt=function(){function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Lt(this,e),this.sri=t,this.sci=n,this.eri=r,this.eci=i,this.w=o,this.h=a}var t,n,r;return t=e,r=[{key:"valueOf",value:function(t){var n=t.split(":"),r=Xt(c.expr2xy(n[0]),2),i=r[0],o=r[1],a=o,s=i;if(n.length>1){var u=Xt(c.expr2xy(n[1]),2);s=u[0],a=u[1]}return new e(o,i,a,s)}}],(n=[{key:"each",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0},r=this.sri,i=this.sci,o=this.eri,a=this.eci,s=!1;e.getRowIterator().setBegin(r).setEnd(o).setLoop((function(r){return n(r)&&e.getColIterator().setBegin(i).setEnd(a).setLoop((function(e){return s=t(r,e)})).execute(),s})).execute()}},{key:"set",value:function(e,t,n,r){this.sri=e,this.sci=t,this.eri=n,this.eci=r}},{key:"multiple",value:function(){return this.eri-this.sri>0||this.eci-this.sci>0}},{key:"includes",value:function(){for(var e=0,t=0,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(1===r.length){var o=c.expr2xy(r[0]),a=Xt(o,2);t=a[0],e=a[1]}else 2===r.length&&(e=r[0],t=r[1]);var s=this.sri,u=this.sci,l=this.eri,h=this.eci;return s<=e&&e<=l&&u<=t&&t<=h}},{key:"contains",value:function(e){return this.sri<=e.sri&&this.sci<=e.sci&&this.eri>=e.eri&&this.eci>=e.eci}},{key:"within",value:function(e){return this.sri>=e.sri&&this.sci>=e.sci&&this.eri<=e.eri&&this.eci<=e.eci}},{key:"disjoint",value:function(e){return this.sri>e.eri||this.sci>e.eci||e.sri>this.eri||e.sci>this.eci}},{key:"intersects",value:function(e){return this.sri<=e.eri&&this.sci<=e.eci&&e.sri<=this.eri&&e.sci<=this.eci}},{key:"union",value:function(t){var n=this.sri,r=this.sci,i=this.eri,o=this.eci;return new e(t.sri<n?t.sri:n,t.sci<r?t.sci:r,t.eri>i?t.eri:i,t.eci>o?t.eci:o)}},{key:"coincide",value:function(t){var n=this.sri,r=this.sci,i=this.eri,o=this.eci;return this.disjoint(t)?e.EMPTY:new e(t.sri>n?t.sri:n,t.sci>r?t.sci:r,t.eri<i?t.eri:i,t.eci<o?t.eci:o)}},{key:"coincideDifference",value:function(t){return this.coincide(t).equals(e.EMPTY)?[]:this.difference(t)}},{key:"difference",value:function(t){var n=[],r=function(t,r,i,o){n.push(new e(t,r,i,o))},i=this.sri,o=this.sci,a=this.eri,s=this.eci,u=t.sri-i,c=t.sci-o,l=a-t.eri,h=s-t.eci;return u>0?(r(i,o,t.sri-1,s),l>0?(r(t.eri+1,o,a,s),c>0&&r(t.sri,o,t.eri,t.sci-1),h>0&&r(t.sri,t.eci+1,t.eri,s)):(c>0&&r(t.sri,o,a,t.sci-1),h>0&&r(t.sri,t.eci+1,a,s))):l>0&&(r(t.eri+1,o,a,s),c>0&&r(i,o,t.eri,t.sci-1),h>0&&r(i,t.eci+1,t.eri,s)),c>0?(r(i,o,a,t.sci-1),h>0?(r(i,t.eri+1,a,s),u>0&&r(i,t.sci,t.sri-1,t.eci),l>0&&r(t.sri+1,t.sci,a,t.eci)):(u>0&&r(i,t.sci,t.sri-1,s),l>0&&r(t.sri+1,t.sci,a,s))):h>0&&(r(i,t.eci+1,a,s),u>0&&r(i,o,t.sri-1,t.eci),l>0&&r(t.eri+1,o,a,t.eci)),n}},{key:"size",value:function(){return[this.eri-this.sri+1,this.eci-this.sci+1]}},{key:"brink",value:function(){var t=this.sri,n=this.eri,r=this.sci,i=this.eci,o=new e(t,r,t,i),a=new e(n,r,n,i);return{top:o,right:new e(t,i,n,i),bottom:a,left:new e(t,r,n,r)}}},{key:"point",value:function(){var t=this.sri,n=this.eri,r=this.sci,i=this.eci;return{lt:new e(t,r,t,r),rt:new e(t,i,t,i),lb:new e(n,r,n,r),rb:new e(n,i,n,i)}}},{key:"equals",value:function(e){return this.eri===e.eri&&this.eci===e.eci&&this.sri===e.sri&&this.sci===e.sci}},{key:"clone",value:function(){return new e(this.sri,this.sci,this.eri,this.eci,this.w,this.h)}},{key:"toString",value:function(){var e=this.sri,t=this.sci,n=this.eri,r=this.eci,i=c.xy2expr(t,e);return this.multiple()&&(i="".concat(i,":").concat(c.xy2expr(r,n))),i}}])&&Dt(t.prototype,n),r&&Dt(t,r),e}();function Bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Wt.EMPTY=new Wt(-1,-1,-1,-1);var Ft=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.undoStack=[],this.redoStack=[],this.layer={event:"",data:[]},this.apply=!1,this.listen=new Yt}var t,n,r;return t=e,(n=[{key:"undo",value:function(){for(var e=this.undoStack.pop(),t=e.data.length-1;t>=0;t--)e.data[t].undo();this.redoStack.push(e),this.listen.execute("change",e.event,"undo")}},{key:"redo",value:function(){for(var e=this.redoStack.pop(),t=0,n=e.data.length;t<n;t++)e.data[t].redo();this.undoStack.push(e),this.listen.execute("change",e.event,"redo")}},{key:"open",value:function(){this.layer={event:"",data:[]},this.apply=!0}},{key:"canRedo",value:function(){return this.redoStack.length>0}},{key:"canUndo",value:function(){return this.undoStack.length>0}},{key:"close",value:function(e){this.layer.data.length&&(this.layer.event=e,this.redoStack=[],this.undoStack.push(this.layer)),this.layer={event:"",data:[]},this.apply=!1,this.listen.execute("change",e,"close")}},{key:"addAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{undo:function(){},redo:function(){}};this.apply&&this.layer.data.push(e)}}])&&Bt(t.prototype,n),r&&Bt(t,r),e}();function Ht(e,t){return e<t?-1:e>t?1:0}function Ut(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function Vt(e,t,n,r,i){!function e(t,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1);e(t,n,Math.max(r,Math.floor(n-s*c/a+l)),Math.min(i,Math.floor(n+(a-s)*c/a+l)),o)}var h=t[n],f=r,v=i;for(Ut(t,r,n),o(t[i],h)>0&&Ut(t,r,i);f<v;){for(Ut(t,f,v),f++,v--;o(t[f],h)<0;)f++;for(;o(t[v],h)>0;)v--}0===o(t[r],h)?Ut(t,r,v):Ut(t,++v,i),v<=n&&(r=v+1),n<=v&&(i=v-1)}}(e,t,n||0,r||e.length-1,i||Ht)}function Gt(e){return function(e){if(Array.isArray(e))return zt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Zt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $t(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function Kt(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Jt(e,t){return e.minX-t.minX}function Qt(e,t){return e.minY-t.minY}function en(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function tn(e){return e.maxX-e.minX+(e.maxY-e.minY)}function nn(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function rn(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function on(e){return{childrenNodes:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function an(e,t,n,r,i){i||(i=on(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=t;o<n;o++){var a=e.childrenNodes[o];Kt(i,e.leaf?r(a):a)}return i}function sn(e,t){an(e,0,e.childrenNodes.length,t,e)}function un(e,t,n,r,i){for(var o=[t,n];o.length;)if(!((n=o.pop())-(t=o.pop())<=r)){var a=t+Math.ceil((n-t)/r/2)*r;Vt(e,a,t,n,i),o.push(t,a,a,n)}}var cn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9;qt(this,e),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}var t,n,r;return t=e,(n=[{key:"all",value:function(){return this._all(this.data,[])}},{key:"search",value:function(e){var t=this.data,n=[];if(!rn(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var o=0;o<t.childrenNodes.length;o++){var a=t.childrenNodes[o],s=t.leaf?r(a):a;rn(e,s)&&(t.leaf?n.push(a):nn(e,s)?this._all(a,n):i.push(a))}t=i.pop()}return n}},{key:"first",value:function(e){return this.search(e)[0]}},{key:"collides",value:function(e){var t=this.data;if(!rn(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.childrenNodes.length;r++){var i=t.childrenNodes[r],o=t.leaf?this.toBBox(i):i;if(rn(e,o)){if(t.leaf||nn(e,o))return!0;n.push(i)}}t=n.pop()}return!1}},{key:"load",value:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.childrenNodes.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data=on([]),this}},{key:"remove",value:function(e,t){if(!e)return this;for(var n,r,i,o=this.data,a=this.toBBox(e),s=[],u=[];o||s.length;){if(o||(o=s.pop(),r=s[s.length-1],n=u.pop(),i=!0),o.leaf){var c=$t(e,o.childrenNodes,t);if(-1!==c)return o.childrenNodes.splice(c,1),s.push(o),this._condense(s),this}i||o.leaf||!nn(o,a)?r?(n++,o=r.childrenNodes[n],i=!1):o=null:(s.push(o),u.push(n),n=0,r=o,o=o.childrenNodes[0])}return this}},{key:"toBBox",value:function(e){return e}},{key:"compareMinX",value:function(e,t){return e.minX-t.minX}},{key:"compareMinY",value:function(e,t){return e.minY-t.minY}},{key:"_all",value:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,Gt(e.childrenNodes)):n.push.apply(n,Gt(e.childrenNodes)),e=n.pop();return t}},{key:"_build",value:function(e,t,n,r){var i,o=n-t+1,a=this._maxEntries;if(o<=a)return sn(i=on(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(i=on([])).leaf=!1,i.height=r;var s=Math.ceil(o/a),u=s*Math.ceil(Math.sqrt(a));un(e,t,n,u,this.compareMinX);for(var c=t;c<=n;c+=u){var l=Math.min(c+u-1,n);un(e,c,l,s,this.compareMinY);for(var h=c;h<=l;h+=s){var f=Math.min(h+s-1,l);i.childrenNodes.push(this._build(e,h,f,r-1))}}return sn(i,this.toBBox),i}},{key:"_chooseSubtree",value:function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,s=0;s<t.childrenNodes.length;s++){var u=t.childrenNodes[s],c=en(u),l=(h=e,f=u,(Math.max(f.maxX,h.maxX)-Math.min(f.minX,h.minX))*(Math.max(f.maxY,h.maxY)-Math.min(f.minY,h.minY))-c);l<o?(o=l,i=c<i?c:i,a=u):l===o&&c<i&&(i=c,a=u)}t=a||t.childrenNodes[0]}var h,f;return t}},{key:"_insert",value:function(e,t,n){var r=n?e:this.toBBox(e),i=[],o=this._chooseSubtree(r,this.data,t,i);for(o.childrenNodes.push(e),Kt(o,r);t>=0&&i[t].childrenNodes.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)}},{key:"_split",value:function(e,t){var n=e[t],r=n.childrenNodes.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),a=on(n.childrenNodes.splice(o,n.childrenNodes.length-o));a.height=n.height,a.leaf=n.leaf,sn(n,this.toBBox),sn(a,this.toBBox),t?e[t-1].childrenNodes.push(a):this._splitRoot(n,a)}},{key:"_splitRoot",value:function(e,t){this.data=on([e,t]),this.data.height=e.height+1,this.data.leaf=!1,sn(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,n){for(var r,i,o,a,s,u,c,l=1/0,h=1/0,f=t;f<=n-t;f++){var v=an(e,0,f,this.toBBox),y=an(e,f,n,this.toBBox),d=(i=v,o=y,a=void 0,s=void 0,u=void 0,c=void 0,a=Math.max(i.minX,o.minX),s=Math.max(i.minY,o.minY),u=Math.min(i.maxX,o.maxX),c=Math.min(i.maxY,o.maxY),Math.max(0,u-a)*Math.max(0,c-s)),p=en(v)+en(y);d<l?(l=d,r=f,h=p<h?p:h):d===l&&p<h&&(h=p,r=f)}return r||n-t}},{key:"_chooseSplitAxis",value:function(e,t,n){var r=e.leaf?this.compareMinX:Jt,i=e.leaf?this.compareMinY:Qt;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.childrenNodes.sort(r)}},{key:"_allDistMargin",value:function(e,t,n,r){e.childrenNodes.sort(r);for(var i=this.toBBox,o=an(e,0,t,i),a=an(e,n-t,n,i),s=tn(o)+tn(a),u=t;u<n-t;u++){var c=e.childrenNodes[u];Kt(o,e.leaf?i(c):c),s+=tn(o)}for(var l=n-t-1;l>=t;l--){var h=e.childrenNodes[l];Kt(a,e.leaf?i(h):h),s+=tn(a)}return s}},{key:"_adjustParentBBoxes",value:function(e,t,n){for(var r=n;r>=0;r--)Kt(t[r],e)}},{key:"_condense",value:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].childrenNodes.length?n>0?(t=e[n-1].childrenNodes).splice(t.indexOf(e[n]),1):this.clear():sn(e[n],this.toBBox)}}])&&Zt(t.prototype,n),r&&Zt(t,r),e}();function ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var hn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"bboxToRange",value:function(e){return new Wt(e.minY,e.minX,e.maxY,e.maxX)}},{key:"rangeToBbox",value:function(e){return{minX:e.sci,minY:e.sri,maxX:e.eci,maxY:e.eri}}}],(n=null)&&ln(t.prototype,n),r&&ln(t,r),e}();function fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var vn=function(){function e(t){var n=t.snapshot,r=void 0===n?new Ft:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.snapshot=r,this.rTree=new cn,this.listen=new Yt}var t,n,r;return t=e,(n=[{key:"getFirstInclude",value:function(e,t){var n={minX:t,minY:e,maxX:t,maxY:e},r=this.rTree.first(n);return r?hn.bboxToRange(r):c.Undef}},{key:"getMasterInclude",value:function(e,t){var n=this.getFirstInclude(e,t);return n.sri===e&&n.sci===t?n:c.Undef}},{key:"getIntersects",value:function(e){var t=this.rTree,n=hn.rangeToBbox(e);return t.search(n).map((function(e){return hn.bboxToRange(e)}))}},{key:"push",value:function(e){var t=this.rTree,n=hn.rangeToBbox(e);return t.insert(n),this}},{key:"shift",value:function(e){for(var t=this.rTree,n=hn.rangeToBbox(e),r=t.search(n),i=0,o=r.length;i<o;i++){var a=r[i];t.remove(a)}return this}},{key:"add",value:function(e){var t=this,n=this.listen,r={undo:function(){t.shift(e)},redo:function(){t.push(e),n.execute("add",e)}};this.snapshot.addAction(r),r.redo()}},{key:"delete",value:function(e){var t=this,n=this.listen,r={undo:function(){t.push(e)},redo:function(){t.shift(e),n.execute("delete",e)}};this.snapshot.addAction(r),r.redo()}},{key:"batchDelete",value:function(e){var t=this,n=this.listen,r={undo:function(){e.forEach((function(e){t.push(e)}))},redo:function(){e.forEach((function(e){t.shift(e)})),n.execute("batchDelete",e)}};this.snapshot.addAction(r),r.redo()}},{key:"getAll",value:function(){return this.rTree.all().map((function(e){return hn.bboxToRange(e)}))}},{key:"union",value:function(e){var t=this.rTree,n=hn.rangeToBbox(e),r=t.search(n);if(0===r.length)return e;for(var i=e.clone(),o=0,a=r.length;o<a;o++){var s=hn.bboxToRange(r[o]);i=i.union(s)}return i.equals(e)?e:this.union(i)}},{key:"getFullRowRange",value:function(t,n){return new Wt(t,0,Math.max(t,t+n-1),e.MAX_COL)}},{key:"getFullColRange",value:function(t,n){return new Wt(0,t,e.MAX_ROW,Math.max(t,t+n-1))}},{key:"rowAfterExpand",value:function(t,n){for(var r={minX:0,minY:t,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minY>t&&(u.minY+=n),u.maxY>t&&(u.maxY+=n)}i.load(o)}},{key:"colAfterExpand",value:function(t,n){for(var r={minX:t,minY:0,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minX>t&&(u.minX+=n),u.maxX>t&&(u.maxX+=n)}i.load(o)}},{key:"rowAfterShrink",value:function(t,n){for(var r={minX:0,minY:t,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minY>t&&(u.minY-=n),u.maxY>t&&(u.maxY-=n)}i.load(o)}},{key:"colAfterShrink",value:function(t,n){for(var r={minX:t,minY:0,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minX>t&&(u.minX-=n),u.maxX>t&&(u.maxX-=n)}i.load(o)}},{key:"rowBeforeExpand",value:function(t,n){for(var r={minX:0,minY:t,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minY>=t&&(u.minY+=n),u.maxY>=t&&(u.maxY+=n)}i.load(o)}},{key:"colBeforeExpand",value:function(t,n){for(var r={minX:t,minY:0,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minX>=t&&(u.minX+=n),u.maxX>=t&&(u.maxX+=n)}i.load(o)}},{key:"rowBeforeShrink",value:function(t,n){for(var r={minX:0,minY:t,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minY>=t&&(u.minY-=n),u.maxY>=t&&(u.maxY-=n)}i.load(o)}},{key:"colBeforeShrink",value:function(t,n){for(var r={minX:t,minY:0,maxX:e.MAX_COL,maxY:e.MAX_ROW},i=this.rTree,o=i.search(r),a=0,s=o.length;a<s;a++){var u=o[a];i.remove(u),u.minX>=t&&(u.minX-=n),u.maxX>=t&&(u.maxX-=n)}i.load(o)}}])&&fn(t.prototype,n),r&&fn(t,r),e}();function yn(e){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dn(Object(n),!0).forEach((function(t){gn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kn(e,t){if(t&&("object"===yn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function xn(e){return(xn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wn(e,t){return(wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}vn.MAX_COL=1433,vn.MAX_ROW=1048576;var Tn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.snapshot,i=void 0===r?new Ft:r,o=n.merges,a=void 0===o?[]:o;return mn(this,t),e=kn(this,xn(t).call(this,{snapshot:i})),a.map((function(e){return Wt.valueOf(e)})).forEach((function(t){return e.add(t)})),e}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wn(e,t)}(t,e),n=t,(r=[{key:"getData",value:function(){return{merges:this.getAll().map((function(e){return e.toString()}))}}},{key:"removeRow",value:function(e,t){var n=this.rTree,r=this.snapshot,i=new Wt(e,0,vn.MAX_ROW,vn.MAX_COL),o=this.getFullRowRange(e,t),a=hn.rangeToBbox(o),s=hn.rangeToBbox(i),u=[],c=[],l={undo:function(){for(var e=u.length,t=0;t<e;t++){var r=u[t];n.remove(r)}n.load(c)},redo:function(){u=[];for(var e=(c=n.search(s)).length,t=0;t<e;t++){var r=c[t],i=pn({},r);if(n.remove(r),i.minY<a.minY){if(i.maxY<a.maxY){var o=i.maxY-a.minY;o+=1,i.oldMax=i.maxY,i.maxY-=o,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}if(i.maxY>a.maxY){var l=a.maxY-s.minY;l+=1,i.oldMax=i.maxY,i.maxY-=l,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}if(i.maxY===a.maxY){var h=a.maxY-s.minY;h+=1,i.oldMax=i.maxY,i.maxY-=h,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}}if(i.minY>a.minY){if(i.minY<a.maxY&&i.maxY>a.maxY){var f=i.minY-a.minY,v=a.maxY-i.minY;v+=f+1,i.oldMax=i.maxY,i.oldMin=i.minY,i.maxY-=v,i.minY-=f,i.style="evenValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}if(i.minY>a.maxY){var y=a.maxY-a.minY;y+=1,i.oldMax=i.maxY,i.oldMin=i.minY,i.maxY-=y,i.minY-=y,i.style="evenValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}}if(i.minY===a.minY&&i.maxY>a.maxY){var d=a.maxY-i.minY;d+=1,i.oldMax=i.maxY,i.maxY-=d,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i)}}n.load(u)}};r.addAction(l),l.redo()}},{key:"removeCol",value:function(e,t){var n=this.rTree,r=this.snapshot,i=new Wt(0,e,vn.MAX_ROW,vn.MAX_COL),o=this.getFullColRange(e,t),a=hn.rangeToBbox(o),s=hn.rangeToBbox(i),u=[],c=[],l={undo:function(){for(var e=u.length,t=0;t<e;t++){var r=u[t];n.remove(r)}n.load(c)},redo:function(){u=[];for(var e=(c=n.search(s)).length,t=0;t<e;t++){var r=c[t],i=pn({},r);if(n.remove(r),i.minX<a.minX){if(i.maxX<a.maxX){var o=i.maxX-a.minX;o+=1,i.oldMax=i.maxX,i.maxX-=o,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}if(i.maxX>a.maxX){var l=a.maxX-s.minX;l+=1,i.oldMax=i.maxX,i.maxX-=l,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}if(i.maxX===a.maxX){var h=a.maxX-s.minX;h+=1,i.oldMax=i.maxX,i.maxX-=h,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}}if(i.minX>a.minX){if(i.minX<a.maxX&&i.maxX>a.maxX){var f=i.minX-a.minX,v=a.maxX-i.minX;v+=f+1,i.oldMax=i.maxX,i.oldMin=i.minX,i.maxX-=v,i.minX-=f,i.style="evenValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}if(i.minX>a.maxX){var y=a.maxX-a.minX;y+=1,i.oldMax=i.maxX,i.oldMin=i.minX,i.maxX-=y,i.minX-=y,i.style="evenValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i);continue}}if(i.minX===a.minX&&i.maxX>a.maxX){var d=a.maxX-i.minX;d+=1,i.oldMax=i.maxX,i.maxX-=d,i.style="oddValue",i.maxX===i.minX&&i.maxY===i.minY||u.push(i)}}n.load(u)}};r.addAction(l),l.redo()}},{key:"insertColAfter",value:function(e,t){var n=this,r={undo:function(){n.colAfterShrink(e,t)},redo:function(){n.colAfterExpand(e,t)}};this.snapshot.addAction(r),r.redo()}},{key:"insertColBefore",value:function(e,t){var n=this,r={undo:function(){n.colBeforeShrink(e,t)},redo:function(){n.colBeforeExpand(e,t)}};this.snapshot.addAction(r),r.redo()}},{key:"insertRowAfter",value:function(e,t){var n=this,r={undo:function(){n.rowAfterShrink(e,t)},redo:function(){n.rowAfterExpand(e,t)}};this.snapshot.addAction(r),r.redo()}},{key:"insertRowBefore",value:function(e,t){var n=this,r={undo:function(){n.rowBeforeShrink(e,t)},redo:function(){n.rowBeforeExpand(e,t)}};this.snapshot.addAction(r),r.redo()}}])&&bn(n.prototype,r),i&&bn(n,i),t}(vn);function En(e){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function On(e,t){if(t&&("object"===En(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Cn(e){return(Cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function An(e,t){return(An=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function In(e,t,n){return t&&_n(e.prototype,t),n&&_n(e,n),e}var Sn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.snapshot,i=void 0===r?new Ft:r,o=n.data,a=void 0===o?[]:o,s=n.merges,u=void 0===s?new Tn:s;return Nn(this,t),(e=On(this,Cn(t).call(this,{data:a}))).snapshot=i,e.merges=u,e.listen=new Yt,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&An(e,t)}(t,e),In(t,null,[{key:"wrapCell",value:function(e){if(e instanceof Rt)return e;if(c.isString(e))return new Rt({text:e});if(c.isDef(e)){var t=e.cell?e.cell:e;return new Rt(t)}return e}}]),In(t,[{key:"getCellOrNew",value:function(e,t){if(e<0)throw new TypeError("错误的行号".concat(e));if(t<0)throw new TypeError("错误的列号".concat(t));var n=this.getCell(e,t);if(c.isUnDef(n)){var r=this.getItemsOrNew(e);n=new Rt,r[t]=n}return n}},{key:"getCell",value:function(e,n){var r=this.data[e];if(r){var i=t.wrapCell(r[n]);return r[n]=i,i}return c.Undef}},{key:"each",value:function(e){for(var t=this.data,n=0,r=t.length;n<r;n++){var i=t[n];if(i)for(var o=0,a=i.length;o<a;o++){e(this.getCell(n,o))}}}},{key:"getCellOrMergeCell",value:function(e,t){var n=this.merges.getFirstInclude(e,t);return n?this.getCell(n.sri,n.sci):this.getCell(e,t)}},{key:"hasCell",value:function(e,t){return c.isDef(this.getCell(e,t))}},{key:"setCell",value:function(e,t,n){var r=this;if(e<0)throw new TypeError("错误的行号".concat(e));if(t<0)throw new TypeError("错误的列号".concat(t));var i=this.listen,o=this.snapshot,a=this.getCell(e,t);if(a){var s={undo:function(){r.getItems(e)[t]=a,i.execute("change",{ri:e,ci:t,oldValue:a})},redo:function(){r.getItemsOrNew(e)[t]=n,i.execute("change",{ri:e,ci:t,oldValue:a})}};o.addAction(s),s.redo()}}},{key:"setCellOrNew",value:function(e,t,n){var r=this;if(e<0)throw new TypeError("错误的行号".concat(e));if(t<0)throw new TypeError("错误的列号".concat(t));var i=this.listen,o=this.snapshot,a=this.hasCell(e,t),s=this.hasItems(e),u=this.getCell(e,t),c={undo:function(){if(s){var n=r.getItems(e);a?n[t]=u:n.splice(t,1),i.execute("change",{ri:e,ci:t,oldValue:u})}else{r.getData().splice(e,1),i.execute("change",{ri:e,ci:t,oldValue:u})}},redo:function(){s?(r.getItems(e)[t]=n,i.execute("change",{ri:e,ci:t,oldValue:u})):(r.getItemsOrNew(e)[t]=n,i.execute("change",{ri:e,ci:t,oldValue:u}))}};o.addAction(c),c.redo()}},{key:"removeRow",value:function(e){var t,n=this,r={undo:function(){t&&n.data.splice(e,0,t)},redo:function(){t=n.data.splice(e,1)[0]}};this.snapshot.addAction(r),r.redo()}},{key:"removeCol",value:function(e){var t=this,n=this.snapshot,r=[],i={undo:function(){for(var n=r.length,i=0;i<n;i++){var o=r[i],a=o.ri,s=o.item;t.data[a].splice(e,0,s)}},redo:function(){var n=t.data.length;r=[];for(var i=0;i<n;i++){var o=t.data[i];if(o){var a=o.splice(e,1)[0];r.push({ri:i,item:a})}}}};n.addAction(i),i.redo()}},{key:"copyRowStyle",value:function(e){var t=this.data[e],n=[];if(t)for(var r=0,i=t.length;r<i;r++){t[r]&&(n[r]=this.getCell(e,r).cloneStyle())}return n}},{key:"insertRowAfter",value:function(e){var t=this,n=this.snapshot,r=e+1,i={undo:function(){t.data.splice(r,1)},redo:function(){var e=t.copyRowStyle(r);t.data.splice(r,0,e)}};n.addAction(i),i.redo()}},{key:"insertColAfter",value:function(e){var t=this,n=this.snapshot,r=e+1,i={undo:function(){for(var e=0,n=t.data.length;e<n;e++){var i=t.data[e];i&&i.splice(r,1)}},redo:function(){for(var e=0,n=t.data.length;e<n;e++){var i=t.data[e];if(i){var o=t.getCell(e,r),a=o?o.cloneStyle():void 0;i.splice(r,0,a)}}}};n.addAction(i),i.redo()}},{key:"insertRowBefore",value:function(e){var t=this,n=this.snapshot,r=e,i={undo:function(){t.data.splice(r,1)},redo:function(){var e=t.copyRowStyle(r);t.data.splice(r,0,e)}};n.addAction(i),i.redo()}},{key:"insertColBefore",value:function(e){var t=this,n=this.snapshot,r=e,i={undo:function(){for(var e=0,n=t.data.length;e<n;e++){var i=t.data[e];i&&i.splice(r,1)}},redo:function(){for(var e=0,n=t.data.length;e<n;e++){var i=t.data[e];if(i){var o=t.getCell(e,r),a=o?o.cloneStyle():void 0;i.splice(r,0,a)}}}};n.addAction(i),i.redo()}}]),t}(function(){function e(t){var n=t.data,r=void 0===n?[]:n;Nn(this,e),this.data=r}return In(e,[{key:"getItems",value:function(e){return this.data[e]}},{key:"clear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.ignoreCorner,r=void 0!==n&&n,i=e.sri,o=e.eri,a=e.sci,s=e.eci,u=this.data,c=this.snapshot,l=u.length,h=[],f=o-i+1,v=s-a+1,y={undo:function(){for(var e=i;e<=o&&!(e>=l);e++){var t=h[e],n=u[e];if(n)for(var c=a;c<=s&&!(c>=l);c++)if(r){if(e===i&&c===a)continue;n[c]=t[c]}else n[c]=t[c]}},redo:function(){h=new Array(f);for(var e=i;e<=o&&!(e>=l);e++){var t=u[e];if(t){for(var n=new Array(v),c=t.length,y=a;y<=s&&!(y>=c);y++)if(r){if(e===i&&y===a)continue;n[y]=t[y],t[y]=void 0}else n[y]=t[y],t[y]=void 0;h[e]=n}}}};c.addAction(y),y.redo()}},{key:"shift",value:function(){return this.data.shift()}},{key:"slice",value:function(e,t,n,r){return this.data.slice(e,n+1).map((function(e){return e?e.slice(t,r+1):e}))}},{key:"getData",value:function(){return this.data}},{key:"getLength",value:function(){return this.data.length}},{key:"hasItems",value:function(e){return c.isDef(this.getItems(e))}},{key:"getItemsOrNew",value:function(e){var t=this.data,n=t[e];return c.isUnDef(n)&&(n=[],t[e]=n),n}}]),e}());addEventListener("message",(function(e){var t=e.data,n=new Sn({data:t}),r=0,i=0;n.each((function(e){if(e)if(e.hasFormula()){var t=e.getComputeText();c.isNumber(t)&&(r+=c.parseFloat(t),i++)}else switch(e.contentType){case Rt.TYPE.NUMBER:r+=e.getComputeText(),i++}})),postMessage({total:r,number:i})}))}]);
//# sourceMappingURL=sumtotal.worker.js.map