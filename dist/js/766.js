!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["x-sheet"]=e():t["x-sheet"]=e()}(self,(function(){return(()=>{"use strict";var t,e,i={1766:(t,e,i)=>{var s=i(4295),r=i(7623),n=i(138),h=i(5523),o=i(8134),a=i(4924),l=i(2552),c=i(1392),d=i(4582),u=i(571);class g extends c.W{constructor({multiple:t=!1,accept:e="*"}){super("input",`${d.gC}-select-file`),this.attr("type","file"),this.attr("accept",e),t&&this.attr("multiple","multiple"),this.accept=e,this.multiple=t}async choose(){return u.t.unbind(this,"change"),this.val(""),new Promise((t=>{u.t.bind(this,"change",(()=>{const e=this.el.files;e.length?this.multiple?t(e):t(e[0]):t(null)})).trigger("click")}))}}function p(t,e,i){if(i<e)return-1;let s=e+i>>>1;return t(s)>0?s===e||t(s-1)<=0?s:p(t,e,s-1):p(t,s+1,i)}function f(t){let e=1;for(;t(e)<=0;)e<<=1;return 0|p(t,e>>>1,e)}g.ACCEPT={XLSX:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",CVS:".csv",TXT:"text/plain",IMAGE:"image/*"};class b{constructor({dpi:t}={}){o.F.isDef(t)?this.dpi=t:this.dpi=f((t=>matchMedia(`(max-resolution: ${t}dpi)`).matches))}getDpi(){return this.dpi}getPixel(t){return t*this.dpi/72}getPoint(t){return 72*t/this.dpi}}class w{constructor({table:t=null,unit:e=null,fontName:i="Arial",fontSize:s=10,fontBold:n=!1,fontItalic:h=!1}={}){if(o.F.isDef(e))this.unit=e;else{const{draw:e,heightUnit:a}=t,l=a.getPixel(s),c=r.d.srcPx(l),d=`${""+(h?"italic":"")} ${""+(n?"bold":"")} ${r.d.trunc(c)}px ${i}`;e.save(),e.attr({font:d.trim()});let u=0;for(let t=0;t<10;t++){const{width:i}=e.measureText(t.toString());i>u&&(u=i)}e.restore(),this.unit=u;const{type:g}=o.F.getExplorerInfo();switch(g){case"Firefox":this.unit=r.d.trunc(u)+.22;break;case"Chrome":this.unit=u}}}getUnit(){return this.unit}getNumberPixel(t){return this.getWidePixel(this.getNumberWide(t))}getWidePixel(t){return r.d.trunc((256*t+r.d.trunc(128/this.unit))/256*this.unit)}getNumberWide(t){return r.d.trunc([t*this.unit+5]/this.unit*256)/256}getPixelNumber(t){return r.d.trunc((t-5)/this.unit*100+.5)/100}}class x{constructor({goto:t=(t=>t),back:e=(t=>t)}={}){this.goto=t,this.back=e}}var m=i(6413);class k{constructor(t,{height:e=30}={}){this.height=e,this.row=t,this.reCkHasAngle=!0,this.hasAngelCell=!1}setHasAngelCell(t){this.hasAngelCell=t}setReCkHasAngle(t){this.reCkHasAngle=t}}class C{constructor(){this.items=[],this.min=1/0,this.max=-1/0}get(t){return this.items[t]}set(t,e){this.items[t]=e,t<this.min&&(this.min=t),t>this.max&&(this.max=t)}}class T{constructor(){this.cache=[]}clear(){this.cache=[]}get(t,e){const i=this.cache[t];return i?i.get(e):null}getItems(t){return this.cache[t]}add(t,e,i){const s=this.cache[t]||new C;s.set(e,i),this.cache[t]=s}}class I{constructor(){this.finishCallback=()=>{},this.loopCallback=()=>{},this.nextCallback=()=>{},this.end=0,this.begin=0}setBegin(t){return this.begin=t,this}setEnd(t){return this.end=t,this}execute(){const{loopCallback:t,nextCallback:e}=this,{begin:i,end:s}=this;let r;if(i>s)for(r=i;r>=s;r-=1,e(r)){if(!1===t(r))break}else for(r=i;r<=s;r+=1,e(r)){if(!1===t(r))break}return this.finishCallback(r),this}setLoop(t){return this.loopCallback=t,this}setNext(t){return this.nextCallback=t,this}setFinish(t){return this.finishCallback=t,this}}let A=[];class y extends I{static getInstance(){return new y}static setFold(t){A=t}constructor(){super(),this.skipCallback=()=>{},this.useFold=!0}execute(){const{loopCallback:t,nextCallback:e,skipCallback:i}=this,{begin:s,end:r,useFold:n}=this;let h;if(s>r)for(h=s;h>=r;h-=1,e(h)){if(n&&A[h]){i(h);continue}if(!1===t(h))break}else for(h=s;h<=r;h+=1,e(h)){if(n&&A[h]){i(h);continue}if(!1===t(h))break}return this.finishCallback(h),this}setSkip(t){return this.skipCallback=t,this}nextRow(){const{begin:t}=this;let e=-1;return this.setLoop((i=>i===t||(e=i,!1))).execute(),e}hasFold(){let t=!1;return this.setLoop((e=>!A[e]||(t=!0,!1))).foldOnOff(!1).execute(),t}foldOnOff(t){return this.useFold=t,this}}class W extends I{nextRow(){const{begin:t}=this;let e=-1;return this.setLoop((i=>i===t||(e=i,!1))).execute(),e}static getInstance(){return new W}}class E{constructor(){this.finishCallback=()=>{},this.loopCallback=()=>{},this.nextCallback=()=>{},this.begin=0,this.end=0,this.handle=null,this.status=E.STATUS.DEFAULT}doWhile(t,e,i){this.handle=setTimeout((()=>{!1!==e()&&(t()?this.handle&&this.doWhile(t,e,i):(this.status=E.STATUS.FINISH,i()))}))}stop(){clearTimeout(this.handle),this.handle=null}setEnd(t){return this.end=t,this}setBegin(t){return this.begin=t,this}execute(){this.status=E.STATUS.DEFAULT;const{loopCallback:t,nextCallback:e}=this,{begin:i,end:s}=this;let r;return i>s?(r=i,this.doWhile((()=>r>=s),(()=>{const i=t(r);return e(r),r-=1,i}),(()=>{this.finishCallback(r)}))):(r=i,this.doWhile((()=>r<=s),(()=>{const i=t(r);return e(r),r+=1,i}),(()=>{this.finishCallback(r)}))),this}setLoop(t){return this.loopCallback=t,this}setNext(t){return this.nextCallback=t,this}setFinish(t){return this.finishCallback=t,this}}E.STATUS={FINISH:1,DEFAULT:2};let H=[];class F extends E{static getInstance(){return new F}static setFold(t){H=t}constructor(){super(),this.skipCallback=()=>{},this.useFold=!0}setSkip(t){return this.skipCallback=t,this}hasFold(){let t=!1;return this.setLoop((e=>!H[e]||(t=!0,!1))).foldOnOff(!1).execute(),t}execute(){this.status=E.STATUS.DEFAULT;const{loopCallback:t,nextCallback:e,skipCallback:i}=this,{begin:s,end:r,useFold:n}=this;let h;return s>r?(h=s,this.doWhile((()=>h>=r),(()=>{if(n&&H[h])return i(h),!0;const s=t(h);return e(h),h-=1,s}),(()=>{this.finishCallback(h)}))):(h=s,this.doWhile((()=>h<=r),(()=>{if(n&&H[h])return i(h),!1;const s=t(h);return e(h),h+=1,s}),(()=>{this.finishCallback(h)}))),this}nextRow(){const{begin:t}=this;let e=-1;return this.setLoop((i=>i===t||(e=i,!1))).execute(),e}foldOnOff(t){return this.useFold=t,this}}class O extends E{nextRow(){const{begin:t}=this;let e=-1;return this.setLoop((i=>i===t||(e=i,!1))).execute(),e}static getInstance(){return new O}}class L{getRowIterator(){return y.getInstance()}getColIterator(){return W.getInstance()}getAsyncRowIterator(){return F.getInstance()}getAsyncColIterator(){return O.getInstance()}}var R=i(4223),v=i(3926);class D{constructor({xIteratorBuilder:t=new L,snapshot:e=new R.a,scaleAdapter:i=new x,len:s=10,data:r=[],height:n=30}={}){this.xIteratorBuilder=t,this.snapshot=e,this.scaleAdapter=i,this.cacheHeight=new T,this.listen=new v.Z,this.min=5,this.len=s,this.data=r,this.height=o.F.minIf(n,this.min),this.data.length>this.len&&(this.len=this.data.length)}getOriginDefaultHeight(){return this.height}clearCache(){this.cacheHeight.clear()}setHeight(t,e){let{listen:i,scaleAdapter:s,snapshot:r}=this,n=this.getOrNew(t),h=n.height,a={undo:()=>{n.height=h,i.execute("changeHeight",n)},redo:()=>{n.height=s.back(o.F.minIf(e,this.min)),i.execute("changeHeight",n)}};r.addAction(a),a.redo()}insertRowAfter(t){let{listen:e,data:i,snapshot:s}=this,r={undo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t+1,1),this.len--,e.execute("insertRowAfter",t)},redo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t+1,0,{}),this.len++,e.execute("insertRowAfter",t)}};s.addAction(r),r.redo()}insertRowBefore(t){let{listen:e,data:i,snapshot:s}=this,r={undo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t,1),this.len--,e.execute("insertRowBefore",t)},redo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t,0,{}),this.len++,e.execute("insertRowBefore",t)}};s.addAction(r),r.redo()}removeRow(t){let e,{listen:i,data:s,snapshot:r}=this,n={undo:()=>{o.F.isDef(t)&&e&&s.splice(t,0,e),this.len++,i.execute("removeRow",t)},redo:()=>{e=o.F.Undef,o.F.isDef(t)&&t<=s.length&&(e=s.splice(t,1)[0]),this.len--,i.execute("removeRow",t)}};r.addAction(n),n.redo()}rectRangeSumHeight(t){return t.equals(m.p.EMPTY)?0:this.sectionSumHeight(t.sri,t.eri)}sectionSumHeight(t,e){let i=0;if(t>e)return i;const s=this.cacheHeight.get(t,e);if(s)return s;const r=this.cacheHeight.getItems(t);return r&&r.min<e?(this.xIteratorBuilder.getRowIterator().setBegin(e).setEnd(t).setLoop((t=>{const e=r.get(t);return e?(i+=e,!1):(i+=this.getHeight(t),!0)})).execute(),this.cacheHeight.add(t,e,i),i):(this.xIteratorBuilder.getRowIterator().setBegin(t).setEnd(e).setLoop((t=>{i+=this.getHeight(t)})).execute(),this.cacheHeight.add(t,e,i),i)}get(t){let e=this.data[t];if(e){if(e instanceof k)return e;e=new k(t,e),this.data[t]=e}return e}getOrNew(t){const e=this.get(t);if(e)return e;if(t<0)throw new TypeError(`错误的行号${t}`);return this.data[t]=new k(t,{height:this.height}),this.data[t]}getMinHeight(){const{scaleAdapter:t}=this;return t.goto(this.min)}getHeight(t){if(t<0)return 0;const{scaleAdapter:e}=this,i=this.get(t);return i&&i.height?e.goto(i.height):e.goto(this.height)}getDefaultHeight(){const{scaleAdapter:t}=this;return t.goto(this.height)}getOriginHeight(t){if(t<0)return 0;const e=this.get(t);return e&&e.height?e.height:this.height}eachHeight(t,e,i,s=0){let r=s;this.xIteratorBuilder.getRowIterator().setBegin(t).setEnd(e).setLoop((t=>{const e=this.getHeight(t);i(t,e,r),r+=e})).execute()}getData(){return{min:this.min,len:this.len,data:this.data,height:this.height}}syncRowsLen(t){t&&(this.len=t.len)}}class B{constructor(t,{width:e=130}={}){this.col=t,this.width=e}}class S{constructor(){this.items=[],this.min=1/0,this.max=-1/0}get(t){return this.items[t]}set(t,e){this.items[t]=e,t<this.min&&(this.min=t),t>this.max&&(this.max=t)}}class P{constructor(){this.cache=[]}clear(){this.cache=[]}get(t,e){const i=this.cache[t];return i?i.get(e):null}getItems(t){return this.cache[t]}add(t,e,i){const s=this.cache[t]||new S;s.set(e,i),this.cache[t]=s}}class N{constructor({xIteratorBuilder:t=new L,snapshot:e=new R.a,scaleAdapter:i=new x,len:s=10,data:r=[],width:n=110}={}){this.xIteratorBuilder=t,this.snapshot=e,this.scaleAdapter=i,this.cacheWidth=new P,this.listen=new v.Z,this.min=5,this.len=s,this.data=r,this.width=o.F.minIf(n,this.min),this.data.length>this.len&&(this.len=this.data.length)}getOriginDefaultWidth(){return this.width}clearCache(){this.cacheWidth.clear()}setWidth(t,e){let{listen:i,scaleAdapter:s,snapshot:r}=this,n=this.getOrNew(t),h=n.width,a={undo:()=>{n.width=h,i.execute("changeWidth",n)},redo:()=>{n.width=s.back(o.F.minIf(e,this.min)),i.execute("changeWidth",n)}};r.addAction(a),a.redo()}insertColAfter(t){let{listen:e,data:i,snapshot:s}=this,r={undo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t+1,1),this.len--,e.execute("insertColAfter",t)},redo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t+1,0,{}),this.len++,e.execute("insertColAfter",t)}};s.addAction(r),r.redo()}insertColBefore(t){let{listen:e,data:i,snapshot:s}=this,r={undo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t,1),this.len--,e.execute("insertColBefore",t)},redo:()=>{o.F.isDef(t)&&t<=i.length&&i.splice(t,0,{}),this.len++,e.execute("insertColBefore",t)}};s.addAction(r),r.redo()}removeCol(t){let e,{listen:i,data:s,snapshot:r}=this,n={undo:()=>{o.F.isDef(t)&&e&&s.splice(t,0,e),this.len++,i.execute("removeCol",t)},redo:()=>{e=o.F.Undef,o.F.isDef(t)&&t<=s.length&&(e=s.splice(t,1)[0]),this.len--,i.execute("removeCol",t)}};r.addAction(n),n.redo()}sectionSumWidth(t,e){let i=0;if(t>e)return i;const s=this.cacheWidth.get(t,e);if(s)return s;const r=this.cacheWidth.getItems(t);return r&&r.min<e?(this.xIteratorBuilder.getColIterator().setBegin(e).setEnd(t).setLoop((t=>{const e=r.get(t);return e?(i+=e,!1):(i+=this.getWidth(t),!0)})).execute(),this.cacheWidth.add(t,e,i),i):(this.xIteratorBuilder.getColIterator().setBegin(t).setEnd(e).setLoop((t=>{i+=this.getWidth(t)})).execute(),this.cacheWidth.add(t,e,i),i)}rectRangeSumWidth(t){return t.equals(m.p.EMPTY)?0:this.sectionSumWidth(t.sci,t.eci)}get(t){let e=this.data[t];if(e){if(e instanceof B)return e;e=new B(t,e),this.data[t]=e}return e}getOrNew(t){const e=this.get(t);if(e)return e;if(t<0)throw new TypeError(`错误的列号${t}`);return this.data[t]=new B(t,{width:this.width}),this.data[t]}getMinWidth(){const{scaleAdapter:t}=this;return t.goto(this.min)}getWidth(t){if(t<0)return 0;const{scaleAdapter:e}=this,i=this.data[t];return i&&i.width?e.goto(i.width):e.goto(this.width)}getDefaultWidth(){const{scaleAdapter:t}=this;return t.goto(this.width)}getOriginWidth(t){if(t<0)return 0;const e=this.data[t];return e&&e.width?e.width:this.width}eachWidth(t,e,i,s=0){let r=s;this.xIteratorBuilder.getColIterator().setBegin(t).setEnd(e).setLoop((t=>{const e=this.getWidth(t);i(t,e,r),r+=e})).execute()}getData(){return{min:this.min,len:this.len,data:this.data,width:this.width}}syncColsLen(t){t&&(this.len=t.len)}}var U=i(7206),_=i(9457);function z(t,e=1){return t+e}class ${constructor({workOptions:t,sheetList:e,dpr:i,unit:s,dpi:n}){r.d.refresh(i),this.workOptions=t,this.sheetList=e,this.heightUnit=new b({dpi:n}),this.wideUnit=new w({unit:s})}async export(){const{workOptions:t,sheetList:e}=this,i=new s.Workbook;i.created=t.created,i.creator=t.creator,i.modified=t.modified,i.lastModifiedBy=t.lastModifiedBy,e.forEach((t=>{const{name:e,tableConfig:s}=t,{table:r,merge:l}=s,{rows:c,cols:d,data:u}=s,g=new U.$({...l}),p=new _.n({data:u}),f=new N(d),b=new D(c),w=i.addWorksheet(e);w.defaultRowHeight=this.rowHeight(b.getOriginDefaultHeight()),w.defaultColWidth=this.colWidth(f.getOriginDefaultWidth()),w.views=[{showGridLines:r.showGrid}];const x=[];f.eachWidth(0,function(t,e=1){return t-e}(f.len),(t=>{const e=f.getOriginWidth(t),i=this.colWidth(e);x.push({width:i})})),w.columns=x;let m=0;for(;p.getLength()>0&&m<b.len;){let t=p.shift(),e=0;if(t){const i=b.getOriginHeight(m),s=this.rowHeight(i),r=w.getRow(z(m));for(r.height=s;t.length>0&&e<f.len;){const i=t.shift();if(i){const t=_.n.wrapCell(i),{contentType:s,background:l}=t,{text:c,fontAttr:d,borderAttr:u}=t,{top:g,right:p,left:f,bottom:b}=u,w=r.getCell(z(e));if(c)switch(s){case a.b.TYPE.NUMBER:w.value=o.F.parseFloat(c);break;case a.b.TYPE.STRING:w.value=c}switch(w.font={name:d.name,color:{argb:n.z.parseRgbToHex(d.color)},size:this.fontSize(d.size),italic:d.italic,bold:d.bold,underline:d.underline,strike:d.strikethrough},w.alignment={vertical:d.verticalAlign,horizontal:d.align,wrapText:d.textWrap===h.W.TEXT_WRAP.WORD_WRAP},d.direction){case h.W.TEXT_DIRECTION.VERTICAL:w.alignment.textRotation="vertical";break;case h.W.TEXT_DIRECTION.ANGLE:case h.W.TEXT_DIRECTION.ANGLE_BAR:w.alignment.textRotation=d.angle}if(l&&(w.fill={type:"pattern",pattern:"solid",fgColor:{argb:n.z.parseRgbToHex(l)}}),w.border={top:{},left:{},right:{},bottom:{}},g.display){const{widthType:t,type:e,color:i}=u.top;w.border.top.style=this.borderType(t,e),w.border.top.color={argb:n.z.parseRgbToHex(i)}}if(p.display){const{widthType:t,type:e,color:i}=u.right;w.border.right.style=this.borderType(t,e),w.border.right.color={argb:n.z.parseRgbToHex(i)}}if(f.display){const{widthType:t,type:e,color:i}=u.left;w.border.left.style=this.borderType(t,e),w.border.left.color={argb:n.z.parseRgbToHex(i)}}if(b.display){const{widthType:t,type:e,color:i}=u.bottom;w.border.bottom.style=this.borderType(t,e),w.border.bottom.color={argb:n.z.parseRgbToHex(i)}}}e++}}m++}g.getAll().forEach((t=>{const{sri:e,sci:i,eri:s,eci:r}=t;w.mergeCells(z(e),z(i),z(s),z(r))}))}));const r=await i.xlsx.writeBuffer();return new Blob([r],{type:g.ACCEPT.XLSX})}fontSize(t){const e=r.d.stylePx(t);return this.heightUnit.getPoint(e)}rowHeight(t){const e=r.d.stylePx(t);return this.heightUnit.getPoint(e)}colWidth(t){return r.d.dpr()>1?this.wideUnit.getPixelNumber(t+5):this.wideUnit.getPixelNumber(t-5)}borderType(t,e){switch(e){case l.H3.SOLID_LINE:switch(t){case r.d.LINE_WIDTH_TYPE.low:return"thin";case r.d.LINE_WIDTH_TYPE.medium:return"medium";case r.d.LINE_WIDTH_TYPE.high:return"thick"}break;case l.H3.POINT_LINE:return"dashDot";case l.H3.DOTTED_LINE:return"dotted";case l.H3.DOUBLE_LINE:return"double"}return"thick"}}self.addEventListener("message",(async t=>{const{workOptions:e,sheetList:i,dpr:s,unit:r,dpi:n}=t.data,h=new $({workOptions:e,sheetList:i,dpr:s,unit:r,dpi:n});self.postMessage(await h.export())}))}},s={};function r(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return i[t](n,n.exports,r),n.exports}return r.m=i,r.x=()=>{var t=r.O(void 0,[295,924,457],(()=>r(1766)));return t=r.O(t)},t=[],r.O=(e,i,s,n)=>{if(!i){var h=1/0;for(c=0;c<t.length;c++){for(var[i,s,n]=t[c],o=!0,a=0;a<i.length;a++)(!1&n||h>=n)&&Object.keys(r.O).every((t=>r.O[t](i[a])))?i.splice(a--,1):(o=!1,n<h&&(h=n));if(o){t.splice(c--,1);var l=s();void 0!==l&&(e=l)}}return e}n=n||0;for(var c=t.length;c>0&&t[c-1][2]>n;c--)t[c]=t[c-1];t[c]=[i,s,n]},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.f={},r.e=t=>Promise.all(Object.keys(r.f).reduce(((e,i)=>(r.f[i](t,e),e)),[])),r.u=t=>"js/"+t+".js",r.miniCssF=t=>{},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t+"../"})(),(()=>{var t={766:1};r.f.i=(e,i)=>{t[e]||importScripts(r.p+r.u(e))};var e=self.webpackChunkx_sheet=self.webpackChunkx_sheet||[],i=e.push.bind(e);e.push=e=>{var[s,n,h]=e;for(var o in n)r.o(n,o)&&(r.m[o]=n[o]);for(h&&h(r);s.length;)t[s.pop()]=1;i(e)}})(),e=r.x,r.x=()=>Promise.all([295,924,457].map(r.e,r)).then(e),r.x()})()}));
//# sourceMappingURL=766.js.map